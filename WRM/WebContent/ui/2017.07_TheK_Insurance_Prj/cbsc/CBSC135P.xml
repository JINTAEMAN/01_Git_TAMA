<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/new.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="DsWs_PlanFlgcd" baseNode="list"
					saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="sClsfCd" name="name1"
							dataType="text">
						</w2:column>
						<w2:column id="sCdType" name="name2"
							dataType="text">
						</w2:column>
						<w2:column id="sCd" name="name3"
							dataType="text">
						</w2:column>
						<w2:column id="sHnglCdName" name="name4"
							dataType="text">
						</w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="PlanMngmVo">
					<w2:keyInfo>
						<w2:key id="gdCd" name="상품코드" dataType="text">
						</w2:key>
						<w2:key id="gnrzCd" name="종형코드"
							dataType="text">
						</w2:key>
						<w2:key id="seqno" name="순번"
							dataType="number">
						</w2:key>
						<w2:key id="planName" name="플랜명"
							dataType="text">
						</w2:key>
						<w2:key id="planFlgcd" name="플랜구분코드"
							dataType="text">
						</w2:key>
						<w2:key id="insPlanNo" name="가입설계번호"
							dataType="text">
						</w2:key>
						<w2:key id="doerTeamCd" name="취급자팀코드"
							dataType="text">
						</w2:key>
						<w2:key id="doer" name="취급자" dataType="text">
						</w2:key>
						<w2:key id="delYn" name="삭제여부"
							dataType="text">
						</w2:key>
						<w2:key id="inptDler" name="입력처리자"
							dataType="text">
						</w2:key>
						<w2:key id="inptDlerIP" name="입력처리자IP"
							dataType="text">
						</w2:key>
						<w2:key id="inptDate" name="입력일자"
							dataType="text">
						</w2:key>
						<w2:key id="inptHms" name="입력시간"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDler" name="수정처리자"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDlerIP" name="수정처리자IP"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDate" name="수정일자"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcHms" name="수정시간"
							dataType="text">
						</w2:key>
						<w2:key id="planDesc" name="플랜상세"
							dataType="text">
						</w2:key>
						<w2:key id="inrpsAge" name="피보험자연령"
							dataType="number">
						</w2:key>
						<w2:key id="inrpsSexFlag" name="피보험자성별구분"
							dataType="text">
						</w2:key>
						<w2:key id="jobGradCd" name="직업급수코드"
							dataType="text">
						</w2:key>
						<w2:key id="gdName" name="상품명"
							dataType="String">
						</w2:key>
						<w2:key id="gnrzName" name="종형명"
							dataType="String">
						</w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
			
		</xf:model>
		<script src="/cm/js/convertJs/Global_Script.js"/>
		<script src="/cm/js/convertJs/comm_Webservice.js"/>
		<script src="/cm/js/convertJs/LongTerm_Script.js"/>
		
		<script type="javascript"><![CDATA[
var sPlanNo;	//설계번호
var sDoer;	//취급자
var sDoerTeamCd;	//취급자팀코드

	scwin.init = function() {
		gfn_getCommonCodes("DsWs_PlanFlgcd", "PlanFlgcd", "id_PlanFlgcd", "N");
		
		//cbs - inparam 처리
		var indata = $w.getParameter("param");
console.log("==CBSC135P popup indata \n"+indata);
	
		if (indata == null || indata == "") {
			scwin.closePopup("등록할 정보가 정확하지 않습니다.");
			return;
		} else {
			var inJSON = JSON.parse(indata);
					
			if (wconv.length(inJSON.sPlanNo) != 12) {
				scwin.closePopup("등록할 플랜정보를 확인하세요.");
				return;
			} else {
				sPlanNo = inJSON.sPlanNo;
				scwin.searchPlanNoInfo();
			}
		}
		
	};

	scwin.btn_save_onclick = function() {
		var planName = id_PlanName.getValue();
		
		if (wconv.trim(planName) == "") {
			wprom.alertF("플랜명을 입력하세요.", {}, id_PlanName);
			return false;
		} else { 
			if (scwin.registerPlan()) {
				wprom.close();
			}
		}
	};
	
	scwin.registerPlan = function() {
		if (PlanMngmVo.get("planFlgcd") == "01") {
			PlanMngmVo.set("doer", sDoer);
			PlanMngmVo.set("doerTeamCd", "");
		} else {
			PlanMngmVo.set("doer", "");
			PlanMngmVo.set("doerTeamCd", sDoerTeamCd);
		}
		
		var trans = new transSub();						// transaction 보낼 객체 생성
		trans.setId("registerPlan");					// transaction 보낼 SubmissionID
		trans.setUrl("/contract/longterm/CBSC0004.do");		// Controller 쪽으로 보낼 주소
		trans.setDs("PlanMngmVo");
		trans.targetDs("PlanMngmVo");
		trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
		trans.send();
	};
	
	scwin.subCallBack = function(e) {
		switch(e.subID){
			case "registerPlan":
				if (e.flag == "s") {
					PlanMngmVo.setJSON(e.result);
					wprom.close();
				} else {
					wprom.alert(e.msg);
				}
				break;
				
			case "retrievePlanNoInfo":
				if (e.flag == "s") {
					if (util.isNull(e.result)) {
						alert("플랜으로 등록할 청약정보가 존재하지 않습니다.");
						id_PlanFlgcd.setDisabled(true);
						btn_save.setDisabled(true);
					} else { 
						PlanMngmVo.setJSON(e.result);
						
						sDoer = PlanMngmVo.get("doer");
						sDoerTeamCd = PlanMngmVo.get("doerTeamCd");
						
						//권한체크-34024:대면총무권한
						if (nfn_checkAuthByID("Ds_id", sDoer, "34024")) {
							id_PlanFlgcd.setValue("02");
						} else {
							id_PlanFlgcd.setValue("01");
							id_PlanFlgcd.setDisabled(true);
						}
						id_PlanName.focus();
					}
				} else {
					wprom.alert(e.msg);
					id_PlanFlgcd.setDisabled(true);
					btn_save.setDisabled(true);
				}
				break;
		}
	};
	
	scwin.closePopup = function(msg) {
		var pro = Promise.resolve();

		pro = pro.then(function(rv) {
			return wprom.alert(msg);
		});
			
		pro = pro.then(function(rv) {
			wprom.close();
		});
	};
	
	scwin.searchPlanNoInfo = function() {
		PlanMngmVo.set("insPlanNo", sPlanNo);
		
		var trans = new transSub();						// transaction 보낼 객체 생성
		trans.setId("retrievePlanNoInfo");					// transaction 보낼 SubmissionID
		trans.setUrl("/contract/longterm/CBSC0010.do");		// Controller 쪽으로 보낼 주소
		trans.setDs("PlanMngmVo");
		trans.targetDs("PlanMngmVo");
		trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
		trans.send();
	};
	]]></script>
	</head>
	<body>
		<xf:group class="contentWrap layer" id="" style="">

			<!-- group:s -->
			<xf:group id="" style="" class="section">
				<xf:group id="" style="" class="tbl_search no_btn">
					<xf:group id="" style="" adaptive=""
						class="w2tb tbl_sc" adaptiveThreshold="" tagname="table">
						<w2:attributes>
							<w2:summary></w2:summary>
						</w2:attributes>
						<xf:group tagname="colgroup">
							<xf:group style="width:35px;"
								tagname="col">
							</xf:group>
							<xf:group style="width:100px"
								tagname="col">
							</xf:group>
							<xf:group style="width:60px;"
								tagname="col">
							</xf:group>
							<xf:group style="" tagname="col"></xf:group>
							<xf:group style="width:80px;"
								tagname="col">
							</xf:group>
							<xf:group style="" tagname="col"></xf:group>
						</xf:group>
						<xf:group tagname="tr" style="">
							<xf:group style="" class="w2tb_th"
								tagname="th">
								상품
							</xf:group>
							<xf:group style="" class="w2tb_td"
								tagname="td">
								<w2:attributes>
									<w2:colspan>3</w2:colspan>
									<w2:rowspan>1</w2:rowspan>
								</w2:attributes>

								<xf:input id="id_Gdnm" style=""
									disabled="true" ref="data:PlanMngmVo.gdName">
								</xf:input>
							</xf:group>
							<xf:group class="w2tb_th" style=""
								tagname="th">
								상품종형
							</xf:group>
							<xf:group class="w2tb_td" style=""
								tagname="td">
								<xf:input disabled="true" id="id_Gnrnm"
									style="" ref="data:PlanMngmVo.gnrzName">
								</xf:input>
							</xf:group>
						</xf:group>
						<xf:group tagname="tr" style="">
							<xf:group style="" class="w2tb_th"
								tagname="th">
								성별
							</xf:group>
							<xf:group style="" class="w2tb_td"
								tagname="td">
								<xf:select1 allOption=""
									appearance="minimal" chooseOption="true" direction="auto"
									disabled="true" disabledClass="" displayMode="label"
									ev:onviewchange="" id="id_InrpsSexFlag" optionOrder="" ref="data:PlanMngmVo.inrpsSexFlag"
									renderType="native" style="
" submenuSize=""
									chooseOptionLabel="   ">
									<xf:choices>
										<xf:item>
											<xf:label><![CDATA[남]]></xf:label>
											<xf:value><![CDATA[1]]></xf:value>
										</xf:item>
										<xf:item>
											<xf:label><![CDATA[여]]></xf:label>
											<xf:value><![CDATA[2]]></xf:value>
										</xf:item>
									</xf:choices>
								</xf:select1>
							</xf:group>
							<xf:group style="" class="w2tb_th"
								tagname="th">
								나이
							</xf:group>
							<xf:group style="" class="w2tb_td"
								tagname="td">
								<xf:input id="id_InrpsAge" style=""
									disabled="true" ref="data:PlanMngmVo.inrpsAge"/>
							</xf:group>
							<xf:group style="" class="w2tb_th"
								tagname="th">
								급수
							</xf:group>
							<xf:group style="" class="w2tb_td"
								tagname="td">
								<xf:input id="id_JobGradCd" style=""
									disabled="true" ref="data:PlanMngmVo.jobGradCd">
								</xf:input>
							</xf:group>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
			<!-- group:e -->

			<!-- group:s -->
			<xf:group class="defaultbox" id="" style="">
				<w2:textbox class="df_tt fl" id="" label="마이플랜등록"
					style="">
				</w2:textbox>
			</xf:group>
			<xf:group id="" style="" class="section">
				<xf:select1 allOption="" appearance="minimal"
					chooseOption="" direction="auto" disabled="" disabledClass=""
					displayMode="label" ev:onviewchange="" id="id_PlanFlgcd"
					optionOrder="" ref="data:PlanMngmVo.planFlgcd" style="width:102px;" submenuSize=""
					renderType="native">
					<xf:choices></xf:choices>
				</xf:select1>
				<xf:input id="id_PlanName" style="width:378px;"
					maxlength="100" tabIndex="1" ref="data:PlanMngmVo.planName">
				</xf:input>
				<w2:anchor id="btn_save"
					ev:onclick="scwin.btn_save_onclick" class="btn_nml1 bul"
					outerDiv="true">
					<xf:label><![CDATA[등록]]></xf:label>
				</w2:anchor>
			</xf:group>
			<!-- group:e -->

			<!-- group:s -->
			<xf:group id="" style="" class="section">
				<w2:textbox label="*플랜명을 입력하세요.(한글 50자 이내)" id=""
					class="txt_blue">
				</w2:textbox>
			</xf:group>
			<!-- group:e -->

		</xf:group>
	</body>
</html>