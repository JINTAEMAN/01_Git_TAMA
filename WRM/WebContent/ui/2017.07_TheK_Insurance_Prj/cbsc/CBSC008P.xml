<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
                <w2:dataList baseNode="list" id="ds_condi" repeatNode="map">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="id_nm" name="id_nm"/>
                        <w2:column dataType="text" id="id_cd" name="id_cd"/>
                    </w2:columnInfo>
                    <w2:data use="true">
                        <w2:row>
                            <id_cd><![CDATA[01]]></id_cd>
                            <id_nm><![CDATA[고객번호]]></id_nm>
                        </w2:row>
                    </w2:data>
                </w2:dataList>
                <w2:dataList baseNode="list" id="Ds_Goods"
                	repeatNode="map">
                	<w2:columnInfo>
                		<w2:column id="sMaxAge" name="name1"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGdCd" name="name2"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sMinAge" name="name3"
                			dataType="text">
                		</w2:column>
                		<w2:column id="GdTypeFlagCd" name="name4"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGdName" name="name5"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGnrzCd" name="name6"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGnrzName" name="name7"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="ds_CommList" repeatNode="map" userData2="//*/vector/data/fCon01910_List"/>
                <w2:dataList baseNode="list" id="DsWs_Goods"
                	repeatNode="map" userData2="//*/vector/data/multi">
                	<w2:columnInfo>
                		<w2:column id="sMaxAge" name="name1"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGdCd" name="name2"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sMinAge" name="name3"
                			dataType="text">
                		</w2:column>
                		<w2:column id="GdTypeFlagCd" name="name4"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGdName" name="name5"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGnrzCd" name="name6"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sGnrzName" name="name7"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="DsWs_Warning" repeatNode="map" userData2="//*/WARNING"/>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
		<script src="/cm/js/convertJs/Global_Script.js"/>
		<script src="/cm/js/convertJs/comm_Webservice.js"/>
		
        <script><![CDATA[
/****************************************************************************
 * 프로그램번호   : B060
 * 프로그램명     : 가입상품조회 및 선택
 * 파일명         : B060.xml
 * 프로그램 내용  : 가입상품조회 및 선택
 * 관련 프로그램  : 
 * 작성자         : 이은연
 * 작성일         : 2010-01-10
 * 저작권         : Copyright ⓒ 2004. the K 손해보험㈜. All Right Reserved.
 * 변경내역       : 
 ****************************************************************************/
  
//  #include "Script::Global_Script.js"
//  #include "Script::comm_Webservice.js"     // js 참조

var sJupiCod;
var sPsnGroupFlag = "";
var sPsnPrprtGroupFlgcd = "";
var sBunsMetdDocuClsfCd = "";
var sGdCd="";

	scwin.init = function() {
		//cbs - inparam 처리
		var indata = $w.getParameter("param");
		var inJSON = JSON.parse(indata);

console.log("==CBSC008P popup indata \n"+indata);		

		//trace("파라미터 값 :::::::::::::::"+ sJupiCode);
		sJupiCod = inJSON.sJupiCode;
		
		if (!util.isNull(inJSON.sPsnGroupFlag)) {
			sPsnGroupFlag = inJSON.sPsnGroupFlag;
		}
		if (!util.isNull(inJSON.sPsnPrprtGroupFlgcd)) {
			sPsnPrprtGroupFlgcd = inJSON.sPsnPrprtGroupFlgcd;
		}
		if (!util.isNull(inJSON.sBunsMetdDocuClsfCd)) {
			sBunsMetdDocuClsfCd = inJSON.sBunsMetdDocuClsfCd;
		}
		
		Edt_GdCd.setValue(inJSON.sGdCd);
		//trace("파라미터 값 sPsnPrprtGroupFlgcd :::::::::::::::"+ sPsnPrprtGroupFlgcd);
		scwin.lfn_Search_Async();
	};

	scwin.lfn_Search_Async = function() { //완료
		util.eventAsyncCall(this, scwin.lfn_Search, "");
	};

//---------------------------------------------------------------------------
// function 명 : lfn_Search
// 내용        : 현재판매중인 상품리스트를 조회
//---------------------------------------------------------------------------
	scwin.lfn_Search = function() {		
		Ds_Goods.removeAll();
		DsWs_Goods.removeAll();

/* OLD S		
	SOBJ_Search.WSDL = gWsdlBasis;
	var MethodObj = gfn_CreateMethodObj(SOBJ_Search, "com.inswave.longterm.prd.rle.task.BCA710Task", "getInsAvaGdList", "", "");
	//trace("sJupiCode==="+sJupiCode);	
	if (sJupiCode){
		gfn_SetParam(MethodObj, "sResno",sJupiCod );
	}
	gfn_SetParam(MethodObj, "sGdCd", trim(Edt_GdCd.Text));
	gfn_SetParam(MethodObj, "sGdNm", trim(Edt_GdName.Text));
	gfn_SetParam(MethodObj, "sUserID", gUserID);
    
    //N1305-00225:장기 재물보험 청약시스템 개발 요청
    //인, 물 가입 가능 상품 구분 처리
    gfn_SetParam(MethodObj, "sPsnPrprtGroupFlgcd", sPsnPrprtGroupFlgcd);
	
	if(sPsnGroupFlag != ""){
		gfn_SetParam(MethodObj, "sPsnGroupFlag", sPsnGroupFlag);
	}
	
	// 업무보고서분류코드(7:연금)
	if (sBunsMetdDocuClsfCd != "") {
		gfn_SetParam(MethodObj, "sBunsMetdDocuClsfCd", sBunsMetdDocuClsfCd);
	}
   //trace("sPsnGroupFlag==="+sPsnGroupFlag);	
   //trace("gUserID==="+gUserID);	
   //trace("sPsnPrprtGroupFlgcd==="+sPsnPrprtGroupFlgcd);	
	var result = gfn_CallService(SOBJ_Search, DOBJ_DataSearch, MethodObj);	
OLD E */

		var MethodObj = new callService("com.inswave.longterm.prd.rle.task.BCA710Task", "getInsAvaGdList", 0, 0);
		MethodObj.setId("getInsAvaGdList");
		
		if (sJupiCod) {
			MethodObj.setParam("sResno", sJupiCod);
		}
		MethodObj.setParam("sGdCd", wconv.trim(Edt_GdCd.getValue()));
		MethodObj.setParam("sGdNm", wconv.trim(Edt_GdName.getValue()));
		MethodObj.setParam("sUserID", util.getGdsValue("gUserID"));
		
		//N1305-00225:장기 재물보험 청약시스템 개발 요청
	    //인, 물 가입 가능 상품 구분 처리
	    MethodObj.setParam("sPsnPrprtGroupFlgcd", sPsnPrprtGroupFlgcd);
		
		if(sPsnGroupFlag != "" || sPsnGroupFlag){
			MethodObj.setParam("sPsnGroupFlag", sPsnGroupFlag);
		}
		
		// 업무보고서분류코드(7:연금)
		if (sBunsMetdDocuClsfCd != "") {
			MethodObj.setParam("sBunsMetdDocuClsfCd", sBunsMetdDocuClsfCd);
		}
				
		MethodObj.setUrl("/contract/CBSC008PController.do");
		MethodObj.setXPath("//*/vector/data/multi");
		MethodObj.addXPath("//WARNING");
		MethodObj.sync();
		MethodObj.send();
		
		util.jSonDsCreate(_tranSync.getDsJson("WARNING"), DsWs_Warning.getID());
		DsWs_Goods.setJSON(_tranSync.result.serviceDs.data[0].multi);
		if (_tranSync.CallServiceResult == false) {	
			alert(DsWs_Warning.getCellData(0, "msg"));
			return;
		}
	    if(DsWs_Goods.getRowCount() == 0){
			wprom.alert("가입할 수 없는 연령입니다.");
	    }else{
			Ds_Goods.setJSON(DsWs_Goods.getAllJSON());
	    }		
	};

//---------------------------------------------------------------------------
// function 명 : lGrd_Goods_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
// 내용        : 그리드에서 상품선택시 처리(상위로 상품명,코드,종형 넘겨줌)
//---------------------------------------------------------------------------
	scwin.Grd_Goods_oncellclick = function(row,col) {
		if(Grd_Goods.getColumnID(col) == "sGdName"){

//		parent.Edt_Gdcd.Text = Grd_Goods.GetCellValue(nRow, 1);
//		parent.Edt_GdHnglName.Text = Grd_Goods.GetCellValue(nRow, 2);
		
			// 직업정보 넘겨줌.
			// 상품코드|상품명|종형코드/종형명
			var returnMsg = Ds_Goods.getCellData(row, "sGdCd") + "^" + Ds_Goods.getCellData(row, "sGdName") + "^" +
			                Ds_Goods.getCellData(row, "sGnrzCd") + "^" + Ds_Goods.getCellData(row, "sGnrzName")+ " " + "^" + 
			                Ds_Goods.getCellData(row, "GdTypeFlagCd") + "^" + Ds_Goods.getCellData(row, "sMinAge")+ " " + "^" +
			                Ds_Goods.getCellData(row, "sMaxAge");
		
			wprom.close(returnMsg);
		}
	};

//---------------------------------------------------------------------------
// function 명 : btn_Close_OnClick(obj)
// 내용        : 프로그램종료
//---------------------------------------------------------------------------
	scwin.btn_Close_OnClick = function(e) {
		wprom.close();
	};
	
//Grd_Goods customFormatter
	scwin.setDisplayGrdGoods = function(data, formattedData, rowIndex, colIndex) {
		var rtnMsg = "";
		
		if (Grd_Goods.getColumnID(colIndex)  == "age") {
			if (Grd_Goods.getCellData(rowIndex, "sMinAge") != "") {
				//substr(sMinAge,1,2) + "세 ~ " + substr(sMaxAge,1,2) + "세"
				rtnMsg = wconv.mid(Grd_Goods.getCellData(rowIndex, "sMinAge"),1,2) + "세 ~ " +
						 wconv.mid(Grd_Goods.getCellData(rowIndex, "sMaxAge"),1,2) + "세";
			}
		}
		
		return rtnMsg;
	};
]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="B060"
        	style="position:absolute; left:0px; top:0px;"
        	userData1="가입상품조회 및 선택[B060_Pop]"
        	userData2=" OnLoadCompleted:scwin.B060_OnLoadCompleted; ">
        	<DataObjects>
        		<DataObject />
        	</DataObjects>
        	<ServiceObjects>
        		<ServiceObject />
        	</ServiceObjects>
        	<xf:group arcsize="6" class="search_area" id="Shape9" style="left:0px;top:30px;width:680px;" userData3="RoundRect">
        	</xf:group><w2:textbox class="sty_lb_Search" id="Static0" label="상품코드"
        		style="position:absolute;height:20px;width:61px;left:9px;VAlign:Middle;top:39px;"
        		tagname="" />
        	<xf:group arcsize="8" class="" id="Shape7"
        		style="position:absolute;  bottom:317px;height:251px; left:4px; top:66px;width:674px;"
        		userData3="RoundRect" />
        	<xf:switch id="switch_118" style=" ">
        		<xf:case id="Default_119" style=" ">
        			<w2:gridView autoFit="allColumn"
        				autoFitMinWidth="100" class="sty_Grid" dataList="Ds_Goods"
        				ev:oncellclick="scwin.Grd_Goods_oncellclick" focusMode="row"
        				id="Grd_Goods" inputType="text" readOnly="true"
        				style="position:absolute; UseDBuff:true;  InputPanel:FALSE;  FixedColSizing:TRUE;  EndLineColor:default;  border:Flat;  AutoEnter:TRUE;  height:241px; left:0px; right:683px;top:74px; width:680px;"
        				tabIndex="3" rowNumVisible="true">
        				<w2:header>
        					<w2:row>
        						<w2:column dataType="text"
        							id="head_id_995" inputType="text" readOnly="true"
        							userData1="0" userData3="0" value="순번" width="0" />
        						<w2:column dataType="text"
        							id="head_id_996" inputType="text" readOnly="true"
        							userData1="1" userData3="0" value="상품코드" width="80" />
        						<w2:column dataType="text"
        							id="head_id_997" inputType="text" readOnly="true"
        							userData1="2" userData3="0" value="상품명" width="*" />
        						<w2:column dataType="text"
        							id="head_id_998" inputType="text" readOnly="true"
        							userData1="3" userData3="0" value="종별" width="150" />
        						<w2:column dataType="text"
        							id="head_id_999" inputType="text" readOnly="true"
        							userData1="4" userData3="0" value="가입연령" width="104" />
        					</w2:row>
        				</w2:header>
        				<w2:gBody>
        					<w2:row>
        						<w2:column dataType="text" id="seq"
        							inputType="text" readOnly="true" textAlign="right"
        							userData1="0" userData3="0" width="0" />
        						<w2:column dataType="text" id="sGdCd"
        							inputType="text" readOnly="true" userData1="1"
        							userData3="0" width="80" textAlign="center" />
        						<w2:column dataType="text" id="sGdName"
        							inputType="link" readOnly="true" userData1="2"
        							userData3="0" width="*" textAlign="left" />
        						<w2:column dataType="text"
        							id="sGnrzName" inputType="text" readOnly="true"
        							userData1="3" userData3="0" width="150" textAlign="left" />
        						<w2:column dataType="text" id="age"
        							inputType="text" readOnly="true" textAlign="center"
        							userData1="4" userData3="0" width="104"
        							customFormatter="scwin.setDisplayGrdGoods" />
        					</w2:row>
        				</w2:gBody>
        			</w2:gridView>
        		</xf:case>
        	</xf:switch>
        	<xf:trigger class="popup_top_btn"
        		ev:onclick="scwin.btn_Close_OnClick" id="btn_Close"
        		style="position:absolute;ImageID:btn_Comm_Close;left:630px;top:0px;"
        		tabIndex="4" type="anchor">
        		<xf:label><![CDATA[닫기]]></xf:label>
        	</xf:trigger>
        	<w2:textbox id="Static5" label="가입상품조회 및 선택"
        		style="position:absolute; VAlign:Middle;  height:20px; left:0px; top:0px; width:197px;"
        		tagname="" class="sub_pop_title01" />
        	<xf:trigger class="btn_Comm_Search"
        		ev:onclick="scwin.lfn_Search_Async" id="btn_search"
        		style="position:absolute;ImageID:btn_Comm_Search;left:608px;top:39px;width:45px;"
        		tabIndex="5" type="anchor">
        		<xf:label><![CDATA[조회]]></xf:label>
        	</xf:trigger>
        	<xf:input class="sty_ipt_search" id="Edt_GdCd"
        		style="position:absolute; ImeMode:native;  border-style:solid;  height:20px;left:79px;top:38px; width:104px;"
        		tabIndex="9" disabled=""/>
        	<xf:input class="sty_ipt_search" id="Edt_GdName"
        		style="position:absolute; ImeMode:native;  border-style:solid;  height:20px;left:255px;top:38px; width:152px;"
        		tabIndex="11" disabled=""/>
        	<w2:textbox class="sty_lb_Search" id="Static1" label="상품명"
        		style="position:absolute;height:20px;width:49px;left:197px;VAlign:Middle;top:39px;"
        		tagname="" />
        	
        </xf:group>
    </body>
</html>
