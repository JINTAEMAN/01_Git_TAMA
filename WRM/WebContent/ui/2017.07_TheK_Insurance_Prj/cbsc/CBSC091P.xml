<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
                <w2:dataList baseNode="list" ev:oncelldatachange="scwin.Ds_ACCBA01_1_OnColumnChanged" id="Ds_ACCBA01_1" repeatNode="map" userData2="//*/vector/data/ACCBA01">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="sApplyType" name="sApplyType"/>
                        <w2:column dataType="text" id="sApplyYM" name="sApplyYM"/>
                        <w2:column dataType="text" id="sApplySer" name="sApplySer"/>
                        <w2:column dataType="text" id="sPolicyNo" name="sPolicyNo"/>
                        <w2:column dataType="text" id="nChangeNo" name="nChangeNo"/>
                        <w2:column dataType="text" id="nEndorseNo" name="nEndorseNo"/>
                        <w2:column dataType="text" id="sFromDate" name="sFromDate"/>
                        <w2:column dataType="text" id="sRectCenter" name="sRectCenter"/>
                        <w2:column dataType="text" id="sRectTeam" name="sRectTeam"/>
                        <w2:column dataType="text" id="sRectGroup" name="sRectGroup"/>
                        <w2:column dataType="text" id="sRectPart" name="sRectPart"/>
                        <w2:column dataType="text" id="sRectAgnt" name="sRectAgnt"/>
                        <w2:column dataType="text" id="sRectDate" name="sRectDate"/>
                        <w2:column dataType="text" id="sRectTime" name="sRectTime"/>
                        <w2:column dataType="text" id="nExptPrem" name="nExptPrem"/>
                        <w2:column dataType="text" id="nRectPrem" name="nRectPrem"/>
                        <w2:column dataType="text" id="sSettleStat" name="sSettleStat"/>
                        <w2:column dataType="text" id="sAcctDate" name="sAcctDate"/>
                        <w2:column dataType="text" id="sCollBranch" name="sCollBranch"/>
                        <w2:column dataType="text" id="sCollNo" name="sCollNo"/>
                        <w2:column dataType="text" id="sInputDate" name="sInputDate"/>
                        <w2:column dataType="text" id="sInputTime" name="sInputTime"/>
                        <w2:column dataType="text" id="sUserID" name="sUserID"/>
                        <w2:column dataType="text" id="sTodt" name="sTodt"/>
                        <w2:column dataType="text" id="sPolHolderName" name="sPolHolderName"/>
                        <w2:column dataType="text" id="nPayNo" name="nPayNo"/>
                        <w2:column dataType="text" id="nInstmNo" name="nInstmNo"/>
                        <w2:column dataType="text" id="nTotPrem" name="nTotPrem"/>
                        <w2:column dataType="text" id="sInsType" name="sInsType"/>
                        <w2:column dataType="text" id="sPolHolderID" name="sPolHolderID"/>
                        <w2:column dataType="text" id="sCollType" name="sCollType"/>
                        <w2:column dataType="text" id="sPubPolicyType" name="sPubPolicyType"/>
                        <w2:column dataType="text" id="sCurrencyCode" name="sCurrencyCode"/>
                        <w2:column dataType="text" id="nForExptPrem" name="nForExptPrem"/>
                        <w2:column dataType="text" id="nRowNum" name="nRowNum"/>
                    </w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="Ds_ACCBA01_2" repeatNode="map" userData2="//*/vector/data/ACCBA01">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="sApplyType" name="sApplyType"/>
                        <w2:column dataType="text" id="sApplyYM" name="sApplyYM"/>
                        <w2:column dataType="text" id="sApplySer" name="sApplySer"/>
                        <w2:column dataType="text" id="sPolicyNo" name="sPolicyNo"/>
                        <w2:column dataType="text" id="nChangeNo" name="nChangeNo"/>
                        <w2:column dataType="text" id="nEndorseNo" name="nEndorseNo"/>
                        <w2:column dataType="text" id="sFromDate" name="sFromDate"/>
                        <w2:column dataType="text" id="sRectCenter" name="sRectCenter"/>
                        <w2:column dataType="text" id="sRectTeam" name="sRectTeam"/>
                        <w2:column dataType="text" id="sRectGroup" name="sRectGroup"/>
                        <w2:column dataType="text" id="sRectPart" name="sRectPart"/>
                        <w2:column dataType="text" id="sRectAgnt" name="sRectAgnt"/>
                        <w2:column dataType="text" id="sRectDate" name="sRectDate"/>
                        <w2:column dataType="text" id="sRectTime" name="sRectTime"/>
                        <w2:column dataType="text" id="nExptPrem" name="nExptPrem"/>
                        <w2:column dataType="text" id="nRectPrem" name="nRectPrem"/>
                        <w2:column dataType="text" id="sSettleStat" name="sSettleStat"/>
                        <w2:column dataType="text" id="sAcctDate" name="sAcctDate"/>
                        <w2:column dataType="text" id="sCollBranch" name="sCollBranch"/>
                        <w2:column dataType="text" id="sCollNo" name="sCollNo"/>
                        <w2:column dataType="text" id="sInputDate" name="sInputDate"/>
                        <w2:column dataType="text" id="sInputTime" name="sInputTime"/>
                        <w2:column dataType="text" id="sUserID" name="sUserID"/>
                        <w2:column dataType="text" id="sTodt" name="sTodt"/>
                        <w2:column dataType="text" id="sPolHolderName" name="sPolHolderName"/>
                        <w2:column dataType="text" id="nPayNo" name="nPayNo"/>
                        <w2:column dataType="text" id="nInstmNo" name="nInstmNo"/>
                        <w2:column dataType="text" id="nTotPrem" name="nTotPrem"/>
                        <w2:column dataType="text" id="sInsType" name="sInsType"/>
                        <w2:column dataType="text" id="sPolHolderID" name="sPolHolderID"/>
                        <w2:column dataType="text" id="sCollType" name="sCollType"/>
                        <w2:column dataType="text" id="sPubPolicyType" name="sPubPolicyType"/>
                        <w2:column dataType="text" id="sCurrencyCode" name="sCurrencyCode"/>
                        <w2:column dataType="text" id="nForExptPrem" name="nForExptPrem"/>
                        <w2:column dataType="text" id="nRowNum" name="nRowNum"/>
                        <w2:column dataType="text" id="sDiffType" name="sDiffType"/>
                        <w2:column dataType="text" id="nDiffAmt" name="nDiffAmt"/>
                    </w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="Ds_DiffType" repeatNode="map">
                    <w2:columnInfo>
                        <w2:column dataType="text" id="CODE" name="CODE"/>
                        <w2:column dataType="text" id="TEXT" name="TEXT"/>
                    </w2:columnInfo>
                    <w2:data use="true">
                        <w2:row>
                            <CODE><![CDATA[2]]></CODE>
                            <TEXT><![CDATA[계약에 반영]]></TEXT>
                        </w2:row>
                        <w2:row>
                            <CODE><![CDATA[3]]></CODE>
                            <TEXT><![CDATA[잡익처리]]></TEXT>
                        </w2:row>
                        <w2:row>
                            <CODE><![CDATA[4]]></CODE>
                            <TEXT><![CDATA[잡손처리]]></TEXT>
                        </w2:row>
                    </w2:data>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
 <script src="/cm/js/common.js"/>
 <script src="/cm/js/val_lib.js"/>
 <script src="/cm/js/util.js"/>
 <script src="/cm/js/transSub.js"/>
 <script src="/cm/js/callService.js"/>
 <script src="/cm/js/gds.js"/>
 <script src="/cm/js/wconv.js"/>
 <script src="/cm/js/convertJs/Global_Script.js"/>
 <script src="/cm/js/convertJs/comm_Webservice.js"/>        
        <script><![CDATA[
/*■■■■■■■■■■■■■■■■■■■■■스크립트 변환 결과■■■■■■■■■■■■■■■■■■■■■
※본 주석은 수작업 변환 참고용입니다. ★개발완료 후에는 필히 삭제해주세요.★
변환시간:  Fri Sep 01 2017 14:10:10 GMT+0900 (대한민국 표준시)
파일ID:  7250_pop.xml

아래의 작업을 먼저 해주세요.


1. scwin.init() 함수에 아래의 글로벌 데이터리스트를 선언합니다.
--> 해당 화면에는 추가할 글로벌 변수가 없습니다. 

2. 공통.JS 파일을 include해주세요.
</xf:model>
 ***include 위치(하단에 주석처리 되어 있습니다.)***
<script><![CDATA[

예시)
</xf:model>
<script src="/cm/js/convertJs/예시입니다.js"/>
<script src="/cm/js/convertJs/예시입니다.js"/>
<script src="/cm/js/convertJs/예시입니다.js"/>
<script><![CDATA[

3. 표준에 어긋난 코딩인 경우 ✖ 으로 return 되어 있습니다. 검색으로 ✖이 나온다면 ASIS 소스를 확인해주세요.
ex) ASIS if(a = 1 and b = 2) {} ------> TOBE if (✖ = 2) {}

4. dialog함수로 팝업을 호출 할 경우에는 실제 파일이 있는 경로로 변경해주세요
ex) 현재 PROJECT_PATH_TEMP입니다. 

-호출구조-

호출구조는 모든 화면이 아닌 변환대상화면을 기준으로 분석하였습니다.
선언하지 않은 변수를 사용중이라면 caller 에서 넘겼을 가능성이 높습니다.
파일 ID는 소스의 form ID로 가정했습니다. 아래의 결과는 따로 확인해주세요.
7250_pop.xml에서 호출 (callee ID):  
7250_pop.xml을 호출   (caller ID):  
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■*/
/*
 *===================================File description================================================
 * Create Date : 2008/11/17
 * Creater     : 서영지
 *====================================================================================================
 */
var gnCount;

//체크박스 선택 건수
//**************************************************************************************************
// OnLoadCompleted
//**************************************************************************************************
scwin.init = function() {
    gnCount = 0;
    scwin.setSelectedApply();
};

//**************************************************************************************************
//  수납확정 화면에서 가져온 값을 세팅한다.
//**************************************************************************************************
scwin.setSelectedApply = function() {
    Ds_ACCBA01_1.removeAll();
    wconv.copy(Ds_ACCBA01_1, parent.Ds_DiffParam);
    util.insertColumn(Ds_ACCBA01_1, [
        [
            "ACCBA01",
            "ACCBA01",
            "text"
        ]
    ]); //체크박스 추가
    sAgnt.setValue(psAgnt);
    sAgntName.setValue(psAgntName);
    nDiffAmt.setValue(pnDiffAmt);

    //잡손처리이면 바꾸지 못하도록 한다.
    if (psDiffType == "4") {
        sDiffType.setValue(psDiffType);
        sDiffType.setDisabled(true);
    }
};

//**************************************************************************************************
// 차액처리 타입에 따라 수납확정 함수를 호출한다.
//**************************************************************************************************
scwin.doCollect = function() {
    //차액을 청약에 반영
    if (sDiffType.getValue() == "2") {
        if (!scwin.doPolicy()) {
            return;
        }
    } else if (sDiffType.getValue() == "3") {
        if (!scwin.doProfit()) {
            return;
        }
    } else if (sDiffType.getValue() == "4") {
        if (!scwin.doLoss()) {
            return;
        }
    }
    parent.doCollSettle(nDiffAmt.getValue(), sDiffType.getValue());
    wconv.close();
};

//**************************************************************************************************
// 차액을 반영할 청약 건을 선택한다.
//**************************************************************************************************
scwin.doPolicy = function() {
    var nCount = 0;
    Ds_ACCBA01_2.removeAll();

    //선택한 청약건을 저장한다.
    for (var i = 0; i < Ds_ACCBA01_1.getRowCount(); i++) {
        if (Ds_ACCBA01_1.getCellData(i, "ACCBA01") == "1") {
            //체크박스가 선택되었으면.
            var insRow = util.insertRow(Ds_ACCBA01_2, nCount);
            /*수작업 변환 개발자 가이드(테스트 중)
            dataList에 row를 추가하고 setCellData를 하는 경우 첫 번째 인자를 insRow로 변경해주세요.*/
            wconv.mi_copyRow(Ds_ACCBA01_2, nCount, "Ds_ACCBA01_1", i);
            nCount++;
            break;
        }
    }



    //청약건은 1건만 선택 가능하다.
    if (nCount == 1) {
        scwin.setDiffToOpener();
    } else {
        wprom.alert("차액을 반영할 청약건을 선택하십시오.");
        return false;
    }
    return true;
};

//**************************************************************************************************
// 차액을 잡익처리한다.
//**************************************************************************************************
scwin.doProfit = function() {
    if (wconv.toNumber(nDiffAmt.getValue()) < 0) {
        wprom.alert("잡익처리는 차액이 (+)인 경우에만 가능합니다.");
        return false;
    }
    scwin.setDiffToOpener();
    return true;
};

//**************************************************************************************************
// 차액을 잡손처리한다.
//**************************************************************************************************
scwin.doLoss = function() {
    var nCount = 0;
    Ds_ACCBA01_2.removeAll();

    //선택한 청약건을 저장한다.
    for (var i = 0; i < Ds_ACCBA01_1.getRowCount(); i++) {
        if (Ds_ACCBA01_1.getCellData(i, "ACCBA01") == "1") {
            //체크박스가 선택되었으면.
            var insRow = util.insertRow(Ds_ACCBA01_2, nCount);
            /*수작업 변환 개발자 가이드(테스트 중)
            dataList에 row를 추가하고 setCellData를 하는 경우 첫 번째 인자를 insRow로 변경해주세요.*/
            wconv.mi_copyRow(Ds_ACCBA01_2, nCount, "Ds_ACCBA01_1", i);
            nCount++;
            break;
        }
    }



    //청약건은 1건만 선택 가능하다.
    if (nCount == 1) {
        scwin.setDiffToOpener();
    } else {
        wprom.alert("차액을 반영할 청약건을 선택하십시오.");
        return false;
    }
    if (wconv.toNumber(nDiffAmt.getValue()) > 0) {
        wprom.alert("잡손처리는 차액이 (-)인 경우에만 가능합니다.");
        return false;
    }
    if (wconv.toNumber(nDiffAmt.getValue()) < -1000) {
        wprom.alert("잡손처리는 -1000원 이하까지만 가능합니다.");
        return false;
    }
    scwin.setDiffToOpener();
    return true;
};

//**************************************************************************************************
//  차액처리 Popup에서 처리한 내용을 Opener에 넘겨준다.
//**************************************************************************************************
scwin.setDiffToOpener = function() {
    Ds_ACCBA01_2.setCellData(0, "sDiffType", sDiffType.getValue()); //차액처리구분
    Ds_ACCBA01_2.setCellData(0, "nDiffAmt", nDiffAmt.getValue()); //차액
    //차액처리 결과 세팅
    parent.Ds_DiffResult.removeAll();
    var insRow = util.insertRow(parent.Ds_DiffResult, 0);
    /*수작업 변환 개발자 가이드(테스트 중)
    dataList에 row를 추가하고 setCellData를 하는 경우 첫 번째 인자를 insRow로 변경해주세요.*/
    wconv.mi_copyRow(parent.Ds_DiffResult, 0, Ds_ACCBA01_2, 0);
};

//**************************************************************************************************
// 선택한 청약건의 개수를 확인한다.
//**************************************************************************************************
scwin.Ds_ACCBA01_1_OnColumnChanged = function(obj, nRow, strColumnID, varOldValue, varNewValue, nPivotIndex) {
    //선택 checkbox를 클릭한 경우 외엔 return
    if (strColumnID != "ACCBA01") {
        return;
    }


    //선택한 경우,
    if (varNewValue == "1") {
        gnCount = gnCount + 1;
    } else if (varOldValue == "1" && varNewValue == "0") {
        gnCount = gnCount - 1;
    }
    if (gnCount > 1) {
        wprom.alert("차액처리 대상은 1건만 선택 가능합니다.");
        Ds_ACCBA01_1.setCellData(nRow, "ACCBA01", "0");
    }
};

//**************************************************************************************************
// 닫기
//**************************************************************************************************
scwin.Btn_Close_OnClick = function(obj) {
    wconv.close();
};
]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="7250_pop"
            style="position:absolute; WorkArea:true;  Ver:1.0;  PidAttrib:7;/*  height:380px;*/ left:0px; top:0px; width:624px;"
            userData1="장기수납확정 차액처리팝업" userData2=" OnLoadCompleted:scwin.OnLoadCompleted; ">
            <DataObjects>
                <DataObject/>
            </DataObjects>
            <ServiceObjects>
                <ServiceObject/>
            </ServiceObjects>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.Btn_Close_OnClick" id="Btn_Close"
                style="position:absolute; ImageID:btn_Comm_Close;  height:20px;left:563px;top:0px; width:25px;" tabIndex="4" type="anchor">
                <xf:label><![CDATA[닫기]]></xf:label>
            </xf:trigger>
            <w2:textbox id="Static5" label="차액처리" style="position:absolute; VAlign:Middle;  height:24px; left:0px; top:0px; " tagname="" class="sub_pop_title01">
</w2:textbox>
            
            <xf:group arcsize="6" class="search_area" id="Shape0"
                style="position:absolute; right:616px; bottom:80px; height:52px; left:0px; top:30px; width:612px;" userData3="RoundRect"/>
            <w2:textbox class="sty_lb_Search" id="Static0" label="취급자"
                style="position:absolute; VAlign:Middle;  text-align:right; height:20px;left:9px;top:35px; width:54px;" tagname=""/>
            <w2:textbox class="sty_lb_Search" id="Static7" label="처리방법"
                style="position:absolute; VAlign:Middle;  text-align:right; height:20px;left:9px;top:59px; width:54px;" tagname=""/>
            <xf:select1 appearance="full" class="sty_ipt_search" cols="3" disabled="true" id="sDiffType" rows="1" selectedIndex="0"
                style="position:absolute; ColumnCount:3; height:20px;left:84px;top:59px; width:236px;" tabIndex="1">
                <xf:choices>
                    <xf:itemset nodeset="data:Ds_DiffType">
                        <xf:label ref="text"/>
                        <xf:value ref="code"/>
                    </xf:itemset>
                </xf:choices>
            </xf:select1>
            <w2:textbox class="sty_lb_Search" id="Static1" label="차액"
                style="position:absolute; VAlign:Middle;  text-align:right; height:20px;left:323px;top:35px; width:54px;" tagname=""/>
            <xf:switch id="switch_17" style=" ">
                <xf:case id="Default_18" style=" ">
                    <w2:gridView autoFit="allColumn" autoFitMinWidth="100" class="sty_Grid" dataList="Ds_ACCBA01_1" focusMode="row"
                        id="Grid1" inputType="text" readOnly="true"
                        style="position:absolute; UseDBuff:true;  InputPanel:FALSE;  EndLineColor:default;  border:Flat;  height:240px; left:0px; right:606px;top:92px; width:612px;" tabIndex="9">
                        <w2:header>
                            <w2:row>
                                <w2:column dataType="text" id="head_id_117" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="0" userData3="0" value="No" width="25"/>
                                <w2:column dataType="text" id="head_id_118" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="1" userData3="0" value="청약번호" width="99"/>
                                <w2:column dataType="text" id="head_id_119" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="2" userData3="0" value="청약일자" width="70"/>
                                <w2:column dataType="text" id="head_id_120" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="3" userData3="0" value="보험기간" width="166"/>
                                <w2:column dataType="text" id="head_id_121" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="4" userData3="0" value="계약자명" width="128"/>
                                <w2:column dataType="text" id="head_id_122" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="5" userData3="0" value="보험료" width="74"/>
                                <w2:column dataType="text" id="head_id_123" inputType="text" readOnly="true" style="height:30px;"
                                    textAlign="center" userData1="6" userData3="0" value="선택" width="30"/>
                            </w2:row>
                            <w2:row/>
                        </w2:header>
                        <w2:gBody>
                            <w2:row>
                                <w2:column dataType="text" expression="currow+1" id="temp_id_124" inputType="expression" readOnly="true"
                                    style="height:27px;" textAlign="center" userData1="0" userData3="0" width="25"/>
                                <w2:column dataType="text" expression="sApplyType+sApplyYM+sApplySer" id="temp_id_125"
                                    inputType="expression" readOnly="true" style="" textAlign="center" userData1="1" userData3="0" width="99"/>
                                <w2:column dataType="text" displayFormat="####/##/##" id="sInputDate" inputType="text" readOnly="true"
                                    style="" textAlign="center" userData1="2" userData3="0" width="70"/>
                                <w2:column dataType="text" displayFormat="####/##/## - ####/##/##" expression="sFromDate + sTodt"
                                    id="temp_id_126" inputType="expression" readOnly="true" style="" textAlign="center" userData1="3"
                                    userData3="0" width="166"/>
                                <w2:column dataType="text" id="sPolHolderName" inputType="text" readOnly="true" style="" textAlign="left"
                                    userData1="4" userData3="0" width="128"/>
                                <w2:column dataType="number" displayFormat="#,###,###,###,###,###" id="nExptPrem" inputType="text"
                                    readOnly="true" style="" textAlign="right" userData1="5" userData3="0" width="74"/>
                                <w2:column dataType="text" id="ACCBA01" inputType="checkbox" readOnly="false" style="" textAlign="center"
                                    userData1="6" userData3="0" width="30"/>
                            </w2:row>
                        </w2:gBody>
                    </w2:gridView>
                </xf:case>
            </xf:switch>
            <xf:input class="sty_ipt_search" dataType="number" disabled="true" id="sAgnt" maxlength="7"
                style="position:absolute; UseIME:FALSE;  ImeMode:none;  border-style:solid;  AutoSkip:TRUE;  height:20px;left:85px;top:35px; width:53px;" tabIndex="11"/>
            <xf:input class="sty_ipt_search" disabled="true" id="sAgntName"
                style="position:absolute; border-style:solid;  height:20px;left:143px;top:35px; width:133px;" tabIndex="12"/>
            <xf:input class="sty_ipt_form" dataType="number" disabled="true" displayFormat="#,###" id="nDiffAmt" placeholder="MaskEdit0"
                style="position:absolute; text-align:right;  border-color:user5;  border-style:solid;  height:20px;left:394px;top:35px; width:103px;" tabIndex="13"/>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.doCollect" id="Btn_Settle"
                style="position:absolute;height:20px;ImageID:btn_Input_03;width:50px;left:487px;top:0px;" tabIndex="14" type="anchor">
                <xf:label><![CDATA[수납확정]]></xf:label>
            </xf:trigger>
        </xf:group>
    </body>
</html>
