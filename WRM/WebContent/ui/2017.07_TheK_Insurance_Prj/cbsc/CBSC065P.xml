<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
    <!-- 
     ###################################################
         파일명 : CBSC065P.xml
         프로그램명 : 
         설 명 :  
         작성자 : 구종식
         작성일 : 2017.09.05
 
         수정일자            수정자                  수정내용
      ==================================================
      2017.09.05        구종식          최초작성
      ###################################################
     -->
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
            	<w2:dataList baseNode="list" id="Ds_ProdList"
            		repeatNode="map">
            		<w2:columnInfo>
            			<w2:column dataType="text" id="sAttrCd1"
            				name="sAttrCd1" />
            			<w2:column dataType="text" id="sCdAttrValue"
            				name="sCdAttrValue" />
            			<w2:column dataType="text" id="sApplStrtDate"
            				name="sApplStrtDate" />
            			<w2:column dataType="text" id="sApplEndDate"
            				name="sApplEndDate" />
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList baseNode="list" id="DsWs_ProdList"
            		repeatNode="map"
            		userData2="//*/hashtable/data/vector/data/LTIBA01">
            		<w2:columnInfo>
            			<w2:column id="sAttrCd1" name="sAttrCd1"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sCdAttrValue" name="sCdAttrValue"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sApplStrtDate"
            				name="sApplStrtDate" dataType="text">
            			</w2:column>
            			<w2:column id="sApplEndDate" name="sApplEndDate"
            				dataType="text">
            			</w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList baseNode="list" id="DsWs_DataWarning"
            		repeatNode="map" userData2="//*/WARNING" />
            	<w2:dataList baseNode="list" id="DsWs_Cnt"
            		repeatNode="map"
            		userData2="//*/hashtable/data/LTIBA01Count">
            		<w2:columnInfo>
            			<w2:column id="nCount" name="nCount"
            				dataType="text">
            			</w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList id="WARNING" baseNode="list"
            		saveRemovedData="true" repeatNode="map">
            	</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
 <script src="/cm/js/common.js"/>
 <script src="/cm/js/val_lib.js"/>
 <script src="/cm/js/util.js"/>
 <script src="/cm/js/transSub.js"/>
 <script src="/cm/js/callService.js"/>
 <script src="/cm/js/gds.js"/>
 <script src="/cm/js/wconv.js"/>
 <script src="/cm/js/wprom.js"/>
 
 <script src="/cm/js/convertJs/Global_Script.js"/>
 <script src="/cm/js/convertJs/comm_Webservice.js"/>
 <script src="/cm/js/convertJs/NewGen_Script.js"/>        
        <script><![CDATA[
/****************************************************************************
 * 프로그램번호   : CBSC065P
 * 프로그램명     : 상품리스트조회(팝업)
 * 파일명         : CBSC065P.xml - (A610_Pop.xml)
 * 프로그램 내용  : 상품리스트조회(팝업)
 * 관련 프로그램  : 
 * 작성자         : 구종식
 * 작성일         : 2017-09-05
 * 저작권         : Copyright ⓒ 2004. the K 손해보험㈜. All Right Reserved.
 * 변경내역       : 
 ****************************************************************************/
var pageSize = "20";
var pageCount = "10";
var args;
var parentInfo;

//---------------------------------------------------------------------------
// function 명 : lfn_OnLoadCompleted
// 내용        : 폼로드할때 처리할 내용
//---------------------------------------------------------------------------
scwin.init = function() {

	var indata = $w.getParameter("param");//
	try {
		args = JSON.parse(indata);
	} catch(e) {}
    //args = wconv.split(parentInfo, "^", true);
    
//    if (wconv.length(args) > 0) {
        if (wconv.length(wconv.trim(args.sFromDate)) < 8 
         || wconv.length(wconv.trim(args.sFromDate)) < 8) {
            Edt_GdCd.setValue(wconv.trim(args.sGoods)); // 상품코드
        } else {
            Edt_GdCd.setValue(wconv.trim(args.sGoods)); // 상품코드
            cal_FromDate.setValue(wconv.trim(args.sFromDate)); // 기준일자(fROM) 
            cal_ToDate.setValue(wconv.trim(args.sToDate)); // 기준일자(TO)			
        }
        scwin.lfn_Search();
//    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_Search
// 내용        : 조회버튼  이벤트 처리
//---------------------------------------------------------------------------
scwin.lfn_Search = function(obj) {

    var sFromDate = wconv.trim(cal_FromDate.getValue());
    var sToDate = wconv.trim(cal_ToDate.getValue());
    if (sFromDate == null || sFromDate == "") {
        wprom.alert("시작일자를 입력하십시요.");
        cal_FromDate.focus();
        return;
    } else if (sToDate == null || sToDate == "") {
        wprom.alert("종료일자를 입력하십시요.");
        cal_ToDate.focus();
        return;
    } else if (sFromDate > sToDate) {
        wprom.alert("종료일이 시작일 이전입니다. 종료일을 확인바랍니다.");
        cal_ToDate.focus();
        return;
    }
    scwin.lfn_getSelectList("1");

    // 페이징처리를 위해 전체 총데이터수를 구한다.
    gfn_MakePagingData(Ds_Page, DsWs_Cnt.getCellData(0, "nCount"), pageSize, pageCount);
    Cmb_Page.setValue("1");
};

//---------------------------------------------------------------------------
// function 명 : lfn_getSelectList
// 내용        : 상품리스트를 조회
//---------------------------------------------------------------------------
scwin.lfn_getSelectList = function(pageNo) {
    wconv.clear(Ds_ProdList);
    wconv.clear(DsWs_ProdList);
	/*origin    
    SOBJ_Search.WSDL = gds.gWsdlBasis;
    var MethodObj = gfn_CreateMethodObj(SOBJ_Search, "com.inswave.longterm.prd.att.task.BAA610Task", "selectProdList", pageSize, pageNo);
    gfn_SetParam(MethodObj, "sAttrFlagCd", "01");
    gfn_SetParam(MethodObj, "sAttrName", "GdHnglName");
    gfn_SetParam(MethodObj, "sGdCd", wconv.trim(Edt_GdCd.getValue()));
    gfn_SetParam(MethodObj, "sGdHnglName", wconv.trim(Edt_GdHnglName.getValue()));
    gfn_SetParam(MethodObj, "sFromDate", wconv.trim(cal_FromDate.getValue()));
    gfn_SetParam(MethodObj, "sToDate", wconv.trim(cal_ToDate.getValue()));
    gfn_SetParam(MethodObj, "sPopGbn", "Y");
    gfn_CallService(SOBJ_Search, DOBJ_DataSearch, MethodObj);
	*/
	var MethodObj = new callService("com.inswave.longterm.prd.att.task.BAA610Task", "selectProdList", pageSize, pageNo);
	MethodObj.setId("selectProdList");
    MethodObj.setParam("sAttrFlagCd", "01");
    MethodObj.setParam("sAttrName", "GdHnglName");
    MethodObj.setParam("sGdCd", wconv.trim(Edt_GdCd.getValue()));
    MethodObj.setParam("sGdHnglName", wconv.trim(Edt_GdHnglName.getValue()));
    MethodObj.setParam("sFromDate", wconv.trim(cal_FromDate.getValue()));
    MethodObj.setParam("sToDate", wconv.trim(cal_ToDate.getValue()));
    MethodObj.setParam("sPopGbn", "Y");
	MethodObj.setUrl("/contract/CBSC065PController.do");
	MethodObj.setXPath("//*/hashtable/data/vector/data/LTIBA01");
	MethodObj.addXPath("//*/hashtable/data/LTIBA01Count");	
	MethodObj.addXPath("//WARNING");
	MethodObj.sync();
	MethodObj.send();

    DsWs_ProdList.setJSON(_tranSync.getDsJson("LTIBA01"));
    Ds_ProdList.setJSON(_tranSync.getDsJson("LTIBA01"));
    DsWs_Cnt.setJSON(_tranSync.getDsJson("LTIBA01Count"));
 
    //에러처리
    if (WARNING.getRowCount() != 0) {
        wprom.alert(WARNING.getCellData(0, "msg"));
        return;
    }
    
    if (DsWs_ProdList.getRowCount() == 0) {
        wprom.alert("조회건이 없습니다.");
    } else {
        //goo필요없음. wconv.copy(Ds_ProdList, "DsWs_ProdList");
    }
};

//**************************************************************************************************
// 페이징 처리 - 페이지 콤보 박스
//**************************************************************************************************
scwin.Cmb_Page_OnChanged = function(info){
    scwin.lfn_getSelectList(info.newValue);
};

//**************************************************************************************************
// 페이징 처리 - 이전 페이지 리스트
//**************************************************************************************************
scwin.Btn_PreV_OnClick = function(e) {
    var ftVal = wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowPosition(), "FILTERCD")) - 1;
    if (wconv.toNumber(maxFilterVal) < wconv.toNumber(ftVal)) {
        wprom.alert("조회의 처음입니다.");
        return;
    } else if (wconv.toNumber(ftVal) < 1) {
        wprom.alert("조회의 처음입니다.");
        return;
    }
    wconv.filter(Ds_Page, "FILTERCD=='" + ftVal + "'",true);
    Cmb_Page.setValue(Ds_Page.getCellData(0, "CODE"));
    scwin.lfn_getSelectList(Cmb_Page.getValue());
};

//**************************************************************************************************
// 페이징 처리 - 이전 페이지
//**************************************************************************************************
scwin.Btn_Pre_OnClick = function(e) {
    var Idx = Cmb_Page.getValue();
    if (wconv.toNumber(Idx) - 1 < 1) {
        wprom.alert("조회의 처음입니다.");
        return;
    }
    scwin.lfn_getSelectList(wconv.toString(wconv.toNumber(Idx) - 1));
    if (Ds_Page.getCellData(0, "CODE") == Idx) {
        wconv.filter(Ds_Page, "FILTERCD=='" + wconv.toString(wconv.toNumber(Ds_Page.getCellData(0, "FILTERCD")) - 1) + "'",true);
        Cmb_Page.setValue(Ds_Page.getCellData((Ds_Page.getRowCount() - 1), "CODE"));
    } else
        Cmb_Page.setValue(wconv.toNumber(Idx) - 1);
};

//**************************************************************************************************
// 페이징 처리 - 다음 페이지
//**************************************************************************************************
scwin.Btn_Next_OnClick = function(e) {
    var Idx = Cmb_Page.getValue();
    if (wconv.toNumber(maxPage) < wconv.toNumber(Idx) + 1) {
        wprom.alert("더이상 자료가 존재하지 않습니다");
        return;
    }
    scwin.lfn_getSelectList(wconv.toString(wconv.toNumber(Idx) + 1));
    if (Ds_Page.getCellData((Ds_Page.getRowCount() -1), "CODE") == Idx) {
        wconv.filter(Ds_Page, "FILTERCD=='" + wconv.toString(wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowCount() - 1, "FILTERCD")) + 1) + "'",true);
    }
    Cmb_Page.setValue(wconv.toNumber(Idx) + 1);
};

//**************************************************************************************************
// 페이징 처리 - 다음 페이지 리스트
//**************************************************************************************************
scwin.Btn_NextV_OnClick = function(obj) {
    var ftVal = wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowPosition(), "FILTERCD")) + 1;
    if (wconv.toNumber(maxFilterVal) < wconv.toNumber(ftVal)) {
        wprom.alert("더이상 자료가 존재하지 않습니다");
        return;
    }
    wconv.filter(Ds_Page, "FILTERCD=='" + ftVal + "'",true);
    Cmb_Page.setValue(Ds_Page.getCellData(0, "CODE"));
    scwin.lfn_getSelectList(Cmb_Page.getValue());
};

//---------------------------------------------------------------------------
// function 명 : lfn_cmb_linkMenu_OnChanged
// 내용        : 링크페이지 선택시 Event처리
//---------------------------------------------------------------------------
scwin.lfn_cmb_linkMenu_OnChanged = function(obj, strCode, strText, nOldIndex, nNewIndex) {
    gfn_OpenLinkPage(strCode);
};

//---------------------------------------------------------------------------
// function 명 : lfn_Edt_GdCd_OnKeyDown
// 내용        : 상품코드입력후 엔터 이벤트
//---------------------------------------------------------------------------
scwin.lfn_Edt_GdCd_OnKeyDown = function(e){//obj, nChar, bShift, bCtrl, bAlt, LLParam, HLParam) {
    if (e.keyCode == 13) {
        scwin.lfn_Search(e);
    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_Edt_GdHnglName_OnKeyDown
// 내용        : 상품명 입력후 엔터 이벤트
//---------------------------------------------------------------------------
scwin.lfn_Edt_GdHnglName_OnKeyDown = function(e){//obj, nChar, bShift, bCtrl, bAlt, LLParam, HLParam) {
    if (e.keyCode == 13) {
        scwin.lfn_Search(e);
    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_cal_FromDate_OnKeyDown
// 내용        : 시작일 입력후 엔터 이벤트
//---------------------------------------------------------------------------
scwin.lfn_cal_FromDate_OnKeyDown = function(e){//obj, nChar, bShift, bCtrl, bAlt, nLLParam, nHLParam) {
    if (e.keyCode == 13) {
        scwin.lfn_Search(e);
    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_cal_ToDate_OnKeyDown
// 내용        : 종료일 입력후 엔터 이벤트
//---------------------------------------------------------------------------
scwin.lfn_cal_ToDate_OnKeyDown = function(e){//obj, nChar, bShift, bCtrl, bAlt, nLLParam, nHLParam) {
    if (e.keyCode == 13) {
        scwin.lfn_Search(e);
    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_Btn_Close_OnClick
// 내용        : 팝업 닫기
//---------------------------------------------------------------------------
scwin.lfn_Btn_Close_OnClick = function(obj) {
    wprom.close("");
};

//---------------------------------------------------------------------------
// function 명 : lfn_btn_ok_OnClick
// 내용        : 부모창으로 데이터 내리고 팝업 닫기
//---------------------------------------------------------------------------
scwin.lfn_btn_ok_OnClick = function(e) {
    var sAttrCd1 = Ds_ProdList.getCellData(Ds_ProdList.getRowPosition(), "sAttrCd1");
    var sCdAttrValue = Ds_ProdList.getCellData(Ds_ProdList.getRowPosition(), "sCdAttrValue");
    if (wconv.length(sAttrCd1) <= 0) {
    	wprom.alert("상품이 선택되지 않았습니다.");
    } else {
    	wprom.close(sAttrCd1 + "^" + sCdAttrValue);
    }
};

//---------------------------------------------------------------------------
// function 명 : lfn_Grd_Prod_List_OnCellDblClick
// 내용        :  조회된 그리드에서 선택된 데이터 메인으로 리턴
//---------------------------------------------------------------------------
scwin.lfn_Grd_Prod_List_OnCellDblClick = function(row,col){
    var sAttrCd1 = Ds_ProdList.getCellData(row, "sAttrCd1");
    var sCdAttrValue = Ds_ProdList.getCellData(row, "sCdAttrValue");
    wprom.close(sAttrCd1 + "^" + sCdAttrValue);
};
]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="Edt_ApplStrtDate"
        	style="position:absolute; WorkArea:true;left:0px;top:0px;"
        	userData1="상품리스트조회"
        	userData2=" OnLoadCompleted:scwin.lfn_OnLoadCompleted; ">
        	<DataObjects>
        		<DataObject />
        	</DataObjects>
        	<ServiceObjects>
        		<ServiceObject />
        	</ServiceObjects>
        	<xf:group arcsize="6" class="search_area" id="Shape9" style="left:0px;top:30px;width:800px;" userData3="RoundRect">
        	</xf:group><xf:trigger class="popup_top_btn"
        		ev:onclick="scwin.lfn_btn_ok_OnClick" id="btn_ok"
        		style="position:absolute;ImageID:btn_Comm_Confirmation;height:20px;left:676px;top:0px;"
        		tabIndex="19" type="anchor">
        		<xf:label><![CDATA[확인]]></xf:label>
        	</xf:trigger>
        	<xf:group arcsize="8" class="" id="Shape5"
        		style="position:absolute;  bottom:399px; height:333px; left:0px; top:66px; width:756px;"
        		userData3="RoundRect" />
        	<w2:textbox class="sty_lb_Search" id="Static0" label="상품명"
        		style="position:absolute;height:20px;width:46px;left:192px;VAlign:Middle;top:39px;"
        		tagname="" />
        	<w2:textbox class="sty_lb_Search" id="Static13" label="시작일자"
        		style="position:absolute;height:20px;width:58px;left:365px;VAlign:Middle;top:39px;"
        		tagname="" />
        	<w2:textbox class="sty_lb_Search" id="Static18" label="상품코드"
        		style="position:absolute;height:20px;width:56px;left:1px;VAlign:Middle;top:39px;"
        		tagname="" />
        	<xf:input class="sty_ipt_search" dataType="number"
        		ev:onblur="" id="Edt_GdCd"
        		maxlength="4"
        		style="position:absolute; border-style:solid;  AutoSkip:TRUE;  height:20px;left:66px;top:39px; width:121px;"
        		tabIndex="0" ev:onkeydown="scwin.lfn_Edt_GdCd_OnKeyDown"/>
        	<w2:textbox id="Static3" label="상품리스트 조회"
        		style="position:absolute; VAlign:Middle;  height:20px; left:0px; top:0px; width:249px;"
        		tagname="" class="sub_pop_title01" />
        	<w2:inputCalendar class="sty_ipt_search"
        		ev:onblur="" id="cal_FromDate"
        		style="position:absolute; Value:TODAY;  SundayTextColor:red;  SaturdayTextColor:blue;  border-style:solid;  height:20px;left:430px;top:39px; width:105px;"
        		tabIndex="2" validCheck="true" ev:onkeydown="scwin.lfn_cal_FromDate_OnKeyDown"/>
        	<w2:textbox id="Static27" label="조회 화면"
        		style="position:absolute; VAlign:Middle;left:0px;top:81px; width:277px;"
        		tagname="" class="sub_pop_title02"/>
        	<xf:input class="sty_ipt_search"
        		ev:onblur=""
        		id="Edt_GdHnglName"
        		style="position:absolute; ImeMode:native;  border-style:solid;  height:20px;left:240px;top:39px; width:121px;"
        		tabIndex="1" ev:onkeydown="scwin.lfn_Edt_GdHnglName_OnKeyDown"/>
        	<xf:switch id="switch_82" style=" ">
        		<xf:case id="Default_83" style=" ">
        			<w2:gridView class="sty_Grid" dataList="Ds_ProdList"
        				ev:onblur="scwin.nfn_CopyGridCell"
        				ev:oncelldblclick="scwin.lfn_Grd_Prod_List_OnCellDblClick"
        				focusMode="row" id="Grd_Prod_List" inputType="text"
        				readOnly="true"
        				style="position:absolute; UseDBuff:true;  InputPanel:FALSE;  EndLineColor:default;  border:Flat;  AutoFitEndLine:Hide;  height:301px; left:0px; right:755px;top:106px; width:800px;"
        				tabIndex="13" autoFit="allColumn" autoFitMinWidth="100">
        				<w2:header>
        					<w2:row>
        						<w2:column dataType="text"
        							id="head_id_619" inputType="text" readOnly="true"
        							style="height:20px;" userData1="0" userData3="0"
        							value="상품코드" width="135" />
        						<w2:column dataType="text"
        							id="head_id_620" inputType="text" readOnly="true"
        							style="height:20px;" userData1="1" userData3="0"
        							value="상품명" width="338" />
        						<w2:column dataType="text"
        							id="head_id_621" inputType="text" readOnly="true"
        							style="height:20px;" userData1="2" userData3="0"
        							value="시작일자" width="135" />
        						<w2:column dataType="text"
        							id="head_id_622" inputType="text" readOnly="true"
        							style="height:20px;" userData1="3" userData3="0"
        							value="종료일자" width="135" />
        						<w2:column width="70" inputType="text"
        							style="height:20px" id="column1" blockSelect="false"
        							displayMode="label">
        						</w2:column>
        					</w2:row>
        				</w2:header>
        				<w2:gBody>
        					<w2:row>
        						<w2:column dataType="text" id="sAttrCd1"
        							inputType="text" readOnly="true" style="height:20px;"
        							textAlign="center" userData1="0" userData3="0"
        							width="135" />
        						<w2:column dataType="text"
        							id="sCdAttrValue" inputType="text" readOnly="true"
        							style="height:20px;" textAlign="left" userData1="1"
        							userData3="0" width="338" />
        						<w2:column dataType="text"
        							displayFormat="####-##-##" id="sApplStrtDate"
        							inputType="text" readOnly="true" style="height:20px;"
        							textAlign="center" userData1="2" userData3="0"
        							width="135" value="" />
        						<w2:column dataType="text"
        							displayFormat="####-##-##" id="sApplEndDate"
        							inputType="text" readOnly="true" style="height:20px;"
        							textAlign="center" userData1="3" userData3="0"
        							width="135" />
        						<w2:column width="70" inputType="text"
        							style="height:20px" id="column2" blockSelect="false"
        							displayMode="label">
        						</w2:column>
        					</w2:row>
        				</w2:gBody>
        			</w2:gridView>
        		</xf:case>
        	</xf:switch>
        	<w2:wframe id="div1" scope="false"
        		src="/cm/common/Main_btn_GridControl.xml"
        		style="position:absolute; height:20px;left:539px;top:72px; width:219px;" />
        	<w2:textbox class="sty_lb_Search" id="Static1" label="종료일자"
        		style="position:absolute;height:20px;width:58px;left:539px;VAlign:Middle;top:39px;"
        		tagname="" />
        	<w2:inputCalendar class="sty_ipt_search"
        		ev:onblur="" id="cal_ToDate"
        		style="position:absolute; Value:99991231;  SundayTextColor:red;  SaturdayTextColor:blue;  border-style:solid;  height:20px;left:603px;top:39px; width:105px;"
        		tabIndex="3" validCheck="true" ev:onkeydown="scwin.lfn_cal_ToDate_OnKeyDown"/>
        	<xf:trigger class="popup_top_btn"
        		ev:onclick="scwin.lfn_Btn_Close_OnClick" id="Button0"
        		style="position:absolute;ImageID:btn_Comm_Close;height:20px;left:738px;top:0px;"
        		tabIndex="17" type="anchor" disabled="">
        		<xf:label><![CDATA[닫기]]></xf:label>
        	</xf:trigger>
        	<xf:trigger class="btn_Comm_Search"
        		ev:onclick="scwin.lfn_Search" id="Button1"
        		style="position:absolute;ImageID:btn_Comm_Search;height:20px;Transparent:TRUE;left:727px;top:37px; width:45px;"
        		tabIndex="18" type="anchor">
        		<xf:label><![CDATA[조회]]></xf:label>
        	</xf:trigger>
        	
        </xf:group>
    </body>
</html>
