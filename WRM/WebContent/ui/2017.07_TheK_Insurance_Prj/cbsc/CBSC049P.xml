<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/new.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataList id="data1" baseNode="list"
					saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="id1" name="" dataType="text"
							ignoreStatus="true">
						</w2:column>
						<w2:column id="id2" name="" dataType="text"></w2:column>
						<w2:column id="id3" name="" dataType="text"></w2:column>
						<w2:column id="id4" name="" dataType="text"></w2:column>
						<w2:column id="id5" name="" dataType="number"></w2:column>
						<w2:column id="id6" name="" dataType="text"></w2:column>
						<w2:column id="id7" name="" dataType="number"></w2:column>
						<w2:column id="id8" name="" dataType="text"></w2:column>
					</w2:columnInfo>
					<w2:data use="true">
						<w2:row>
							<id1><![CDATA[1]]></id1>
							<id2><![CDATA[내국인]]></id2>
							<id3><![CDATA[3]]></id3>
							<id4><![CDATA[45]]></id4>
							<id5><![CDATA[5]]></id5>
							<id6><![CDATA[7]]></id6>
							<id7><![CDATA[8]]></id7>
							<id8><![CDATA[1]]></id8>
							<id9><![CDATA[0]]></id9>
							<id10><![CDATA[1]]></id10>
						</w2:row>
						<w2:row>
							<id1><![CDATA[2]]></id1>
						</w2:row>
						<w2:row>
							<id1><![CDATA[3]]></id1>
						</w2:row>
						<w2:row>
							<id1><![CDATA[4]]></id1>
						</w2:row>
						<w2:row>
							<id1><![CDATA[5]]></id1>
						</w2:row>
						<w2:row>
							<id1><![CDATA[6]]></id1>
						</w2:row>
					</w2:data>
				</w2:dataList>
				<w2:dataList id="PlanMngmListVo" baseNode="list"
					saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="gdCd" name="상품코드"
							dataType="text">
						</w2:column>
						<w2:column id="gnrzCd" name="종형코드"
							dataType="text">
						</w2:column>
						<w2:column id="seqno" name="순번"
							dataType="number">
						</w2:column>
						<w2:column id="planName" name="플랜명"
							dataType="text">
						</w2:column>
						<w2:column id="planFlgcd" name="플랜구분코드"
							dataType="text">
						</w2:column>
						<w2:column id="insPlanNo" name="가입설계번호"
							dataType="text">
						</w2:column>
						<w2:column id="doerTeamCd" name="취급자팀코드"
							dataType="text">
						</w2:column>
						<w2:column id="doer" name="취급자"
							dataType="text">
						</w2:column>
						<w2:column id="delYn" name="삭제여부"
							dataType="text">
						</w2:column>
						<w2:column id="inptDler" name="입력처리자"
							dataType="text">
						</w2:column>
						<w2:column id="inptDlerIP" name="입력처리자IP"
							dataType="text">
						</w2:column>
						<w2:column id="inptDate" name="입력일자"
							dataType="text">
						</w2:column>
						<w2:column id="inptHms" name="입력시간"
							dataType="text">
						</w2:column>
						<w2:column id="mdfcDler" name="수정처리자"
							dataType="text">
						</w2:column>
						<w2:column id="mdfcDlerIP" name="수정처리자IP"
							dataType="text">
						</w2:column>
						<w2:column id="mdfcDate" name="수정일자"
							dataType="text">
						</w2:column>
						<w2:column id="mdfcHms" name="수정시간"
							dataType="text">
						</w2:column>
						<w2:column id="planDesc" name="플랜상세"
							dataType="text">
						</w2:column>
						<w2:column id="inrpsAge" name="피보험자연령"
							dataType="number">
						</w2:column>
						<w2:column id="inrpsSexFlag" name="피보험자성별구분"
							dataType="text">
						</w2:column>
						<w2:column id="jobGradCd" name="직업급수코드"
							dataType="text">
						</w2:column>
						<w2:column id="depth" name="Tree level"
							dataType="number">
						</w2:column>
					</w2:columnInfo>
					<w2:data use="false">
					</w2:data>
				</w2:dataList>
				<w2:dataMap baseNode="map" id="PlanMngmVo">
					<w2:keyInfo>
						<w2:key id="gdCd" name="상품코드" dataType="text">
						</w2:key>
						<w2:key id="gnrzCd" name="종형코드"
							dataType="text">
						</w2:key>
						<w2:key id="seqno" name="순번"
							dataType="number">
						</w2:key>
						<w2:key id="planName" name="플랜명"
							dataType="text">
						</w2:key>
						<w2:key id="planFlgcd" name="플랜구분코드"
							dataType="text">
						</w2:key>
						<w2:key id="insPlanNo" name="가입설계번호"
							dataType="text">
						</w2:key>
						<w2:key id="doerTeamCd" name="취급자팀코드"
							dataType="text">
						</w2:key>
						<w2:key id="doer" name="취급자" dataType="text">
						</w2:key>
						<w2:key id="delYn" name="삭제여부"
							dataType="text">
						</w2:key>
						<w2:key id="inptDler" name="입력처리자"
							dataType="text">
						</w2:key>
						<w2:key id="inptDlerIP" name="입력처리자IP"
							dataType="text">
						</w2:key>
						<w2:key id="inptDate" name="입력일자"
							dataType="text">
						</w2:key>
						<w2:key id="inptHms" name="입력시간"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDler" name="수정처리자"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDlerIP" name="수정처리자IP"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcDate" name="수정일자"
							dataType="text">
						</w2:key>
						<w2:key id="mdfcHms" name="수정시간"
							dataType="text">
						</w2:key>
						<w2:key id="planDesc" name="플랜상세"
							dataType="text">
						</w2:key>
						<w2:key id="inrpsAge" name="피보험자연령"
							dataType="number">
						</w2:key>
						<w2:key id="inrpsSexFlag" name="피보험자성별구분"
							dataType="text">
						</w2:key>
						<w2:key id="jobGradCd" name="직업급수코드"
							dataType="text">
						</w2:key>
					</w2:keyInfo>
				</w2:dataMap>
				<w2:dataList id="PlanTrtyListVo" baseNode="list"
					saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="trtyCd" name="특약코드"
							dataType="text">
						</w2:column>
						<w2:column id="trtyName" name="특약명"
							dataType="text">
						</w2:column>
						<w2:column id="trtyInsAmt" name="특약가입금액"
							dataType="bigDecimal">
						</w2:column>
						<w2:column id="trtyOrdr" name="특약순서"
							dataType="number">
						</w2:column>
						<w2:column id="scrnIndcYn" name="화면표시여부"
							dataType="text">
						</w2:column>
					</w2:columnInfo>
				</w2:dataList>
				<w2:dataList id="PlanTrtyInsAmtComVo" baseNode="list"
					saveRemovedData="true" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="attrCd1" name="속성코드1"
							dataType="String">
						</w2:column>
						<w2:column id="attrCd2" name="속성코드1"
							dataType="String">
						</w2:column>
						<w2:column id="attrValuePstn" name="속성값위치"
							dataType="String">
						</w2:column>
						<w2:column id="cdAttrValue" name="CODE속성값"
							dataType="String">
						</w2:column>
						<w2:column id="hnglCdName" name="한글명"
							dataType="String">
						</w2:column>
						<w2:column id="engCdName" name="영문명"
							dataType="String">
						</w2:column>
						<w2:column id="numAttrValue" name="숫자속성값"
							dataType="String">
						</w2:column>
						<w2:column id="seqno" name="순번"
							dataType="number">
						</w2:column>
					</w2:columnInfo>
				</w2:dataList>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
			
		</xf:model>
		<script src="/cm/js/convertJs/LongTerm_Script.js"/>
		
		<script type="javascript"><![CDATA[
var sJupiCod;
var sPsnGroupFlag = "";
var sPsnPrprtGroupFlgcd;
var sBunsMetdDocuClsfCd = "";
var sGdCd="";
var sGnrzCd = "";
var sDoer = "";
var sDoerTeamCd;	//취급자팀코드

	scwin.init = function() {
		//cbs - inparam 처리
		var indata = $w.getParameter("param");
		var inJSON = JSON.parse(indata);

console.log("==CBSC049P popup indata \n"+indata);		

		//trace("파라미터 값 :::::::::::::::"+ sJupiCode);
		sJupiCod = inJSON.sJupiCode;

		if (util.isNull(inJSON.sDoer)) {
			wprom.alert("취급자정보를 확인하세요.");
			return;
		} else {
			sDoer = inJSON.sDoer;
			sDoerTeamCd = inJSON.sDoerTeamCd;
			
			if (util.isNull(inJSON.sPsnPrprtGroupFlgcd)) {
				sPsnPrprtGroupFlgcd = "";
			} else {
				sPsnPrprtGroupFlgcd = inJSON.sPsnPrprtGroupFlgcd;
			}
			
			if (!util.isNull(inJSON.sGdCd)) {
				id_GdCd.setValue(inJSON.sGdCd);
				id_GdName.setValue(inJSON.sGdName);
				
				sGnrzCd = inJSON.sGnrzCd;
				
				scwin.lfn_Search();
			}
		}
	};
	
	scwin.lfn_Search = function() {
		scwin.selectClear();
		
		PlanMngmVo.set("gdCd", id_GdCd.getValue());
		PlanMngmVo.set("gnrzCd", sGnrzCd);
		PlanMngmVo.set("doer", sDoer);
		PlanMngmVo.set("doerTeamCd", sDoerTeamCd);
		
		var trans = new transSub();						// transaction 보낼 객체 생성
		trans.setId("retrievePlanList");					// transaction 보낼 SubmissionID
		trans.setUrl("/contract/longterm/CBSC0005.do");		// Controller 쪽으로 보낼 주소
		trans.setDs("PlanMngmVo");
		trans.targetDs("PlanMngmVo");
		trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
		trans.send();
	};
	
	scwin.subCallBack = function(e) {
		switch(e.subID){
			case "retrievePlanList":
				if (e.flag == "s") {
					PlanMngmListVo.setJSON(e.result.listPlanMngmVo);
				} else {
					wprom.alert(e.msg);
				}
				break;
				
			case "retrievePlanTrty":
				if (e.flag == "s") {
					PlanTrtyInsAmtComVo.setJSON(e.result.listPlanTrtyInsAmtComVo);
					PlanTrtyListVo.setJSON(e.result.listPlanTrtyVo);
				} else {
					wprom.alert(e.msg);
				}
				break;
				
			case "modifyPlanDelYn":
				if (e.flag == "s") {
					var sRowIndex = id_insPlanNo.getUserData("sRowIndex");
					PlanMngmListVo.removeRow(sRowIndex);
					scwin.selectClear();
					wprom.alert("플랜이 삭제되었습니다.");
				} else {
					wprom.alert(e.msg);
				}
				break;
			
		}
	};
	
	scwin.id_btnGdCd_onclick = function() {
		var pro = Promise.resolve();
		
		pro = pro.then(function(rv) {
			var indata  = {	"sJupiCode" : sJupiCod,
							"sPsnGroupFlag" : sPsnGroupFlag,
							"sPsnPrprtGroupFlgcd" : sPsnPrprtGroupFlgcd,
							"sBunsMetdDocuClsfCd" : sBunsMetdDocuClsfCd
						  };
				
			var popInfo = {
				"width"     : 715,
				"height"    : 380,  
				"indata"    : indata,
				"title"     : "가입상품조회 및 선택",
				"callback"  : scwin.popupCallback
			};
			
			return wprom.popupOpen("/ui/cbsc/CBSC008P.xml", popInfo);
		});
			
		pro = pro.then(function(rv) {
			var rtnValue = wprom.getReturnData();
			if (rtnValue != "") {
				var gdCdArr = rtnValue.split("^");
				
				id_GdCd.setValue(gdCdArr[0]);
				id_GdName.setValue(gdCdArr[1]);
				
				sGnrzCd = gdCdArr[2];
				
				scwin.lfn_Search();
			}
		});		
	};
	
	scwin.id_close_onclick = function() {
		wprom.close();
	};
	
	scwin.btn_Search_onclick = function() {
		if (util.isNull(id_GdCd.getValue())) {
			wprom.alert("상품코드를 선택하세요.");
		} else {
			scwin.lfn_Search();
		}
	};
	
	scwin.id_planList_onlabelclick = function(value,nodeElement,index) {
		if (value != "") {
			id_planName.setValue(PlanMngmListVo.getCellData(index-1 , "planName"));
			id_insPlanNo.setUserData("sRowIndex", index-1);
			id_insPlanNo.setValue(value);
			
			PlanMngmVo.set("insPlanNo", value);
			
			var trans = new transSub();						// transaction 보낼 객체 생성
			trans.setId("retrievePlanTrty");					// transaction 보낼 SubmissionID
			trans.setUrl("/contract/longterm/CBSC0006.do");		// Controller 쪽으로 보낼 주소
			trans.setDs("PlanMngmVo");
			trans.targetDs("PlanMngmVo");
			trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
			trans.send();
		} else {
			scwin.selectClear();
		}
	};
	
	scwin.selectClear = function() {
		id_planName.setValue("");
		id_insPlanNo.setValue("");
		id_insPlanNo.setUserData("sRowIndex", "");
		
		PlanTrtyListVo.removeAll();
	}
	
	scwin.id_confirm_onclick = function() {
		var insPlanNo = id_insPlanNo.getValue();
		
		if (insPlanNo == "") {
			wprom.alert("플랜을 선택하세요.");
			return false;
		} else {
			var returnMsg = insPlanNo+"^"+id_planName.getValue();
		
			wprom.close(returnMsg);
		}
	};
	
	
	scwin.id_delete_onclick = function() {
		var insPlanNo = id_insPlanNo.getValue();
		
		if (insPlanNo == "") {
			wprom.alert("삭제할 플랜을 선택하세요.");
			return false;
		} else {
			var sRowIndex = id_insPlanNo.getUserData("sRowIndex");
			PlanMngmVo.set("gdCd", PlanMngmListVo.getCellData(sRowIndex, "gdCd"));
			PlanMngmVo.set("gnrzCd", PlanMngmListVo.getCellData(sRowIndex, "gnrzCd"));
			PlanMngmVo.set("seqno", PlanMngmListVo.getCellData(sRowIndex, "seqno"));
			
			var trans = new transSub();						// transaction 보낼 객체 생성
			trans.setId("modifyPlanDelYn");					// transaction 보낼 SubmissionID
			trans.setUrl("/contract/longterm/CBSC0007.do");		// Controller 쪽으로 보낼 주소
			trans.setDs("PlanMngmVo");
			trans.targetDs("PlanMngmVo");
			trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
			trans.send();
		}
	};
	]]></script>
	</head>
	<body>
		<xf:group class="contentWrap layer" id="" style="">

			<!-- group:s -->
			<xf:group id="" style="" class="section">
				<xf:group id="" style="" class="defaultbox">
					<w2:textbox id="" style="" class="df_tt fl"
						label="상품정보조회">
					</w2:textbox>
					<xf:group class="fr" id="" style="">
						<w2:anchor class="btn_nml" ev:onclick="scwin.id_close_onclick" id="id_close"
							outerDiv="true">
							<xf:label><![CDATA[닫기]]></xf:label>
						</w2:anchor>
					</xf:group>
				</xf:group>
				<xf:group id="" style="" class="tbl_search">
					<xf:group id="" style="" adaptive="" class="w2tb tbl_sc" adaptiveThreshold="" tagname="table">
						<w2:attributes>
							<w2:summary></w2:summary>
						</w2:attributes>
						<xf:group tagname="colgroup">
							<xf:group style="width:50.00px;" tagname="col"></xf:group>
							<xf:group style="" tagname="col"></xf:group>
						</xf:group>
						<xf:group tagname="tr" style="">
							<xf:group style="" class="w2tb_th" tagname="th">상품</xf:group>
							<xf:group style="" class="w2tb_td" tagname="td">
								<xf:group class="input_btn icon sch fl" style="width:60px">
									<xf:input id="id_GdCd" ref="" style="" disabled="true"></xf:input>
									<w2:anchor id="id_btnGdCd" style="" ev:onclick="scwin.id_btnGdCd_onclick" class="" outerDiv="">
										<xf:label><![CDATA[저장]]></xf:label>
									</w2:anchor>
								</xf:group>
								
								<xf:input id="id_GdName" style="width:350px;" class="ml10" disabled="true"></xf:input>
							</xf:group>
						</xf:group>
					</xf:group>
					<w2:anchor id="btn_Search" style="" ev:onclick="scwin.btn_Search_onclick" class="btn_sh" outerDiv="true" disabled="">
						<xf:label><![CDATA[조회]]></xf:label>
					</w2:anchor>
				</xf:group>
			</xf:group>
			<!-- group:e -->

			<!-- group:s -->
			<xf:group id="" style="" class="section hori plan">

				<xf:group id="" style="" class="defaultbox">
					<xf:group class="l">
						<w2:textbox id="" style="" class="df_tt fl" label="플랜정보"></w2:textbox>
					</xf:group>
					<xf:group class="r">
						<w2:textbox id="" style="" class="df_tt fl" label="플랜상세정보"></w2:textbox>
					</xf:group>
				</xf:group>
				<xf:group id="" style="" class="pr cb">
					<xf:group class="l" style="">
						
						<xf:group class="tree_myplan ">
							<w2:textbox id="" style="" class="tt" label="플랜명"></w2:textbox>
							<w2:treeview dataType="listed"
								id="id_planList" lineShow="" style="height:304px"
								tooltipGroupClass="false" useDrag="" class="tree01"
								ev:onclick=""
								ev:onlabelclick="scwin.id_planList_onlabelclick">
								<w2:itemset
									nodeset="data:PlanMngmListVo">
									<w2:label ref="planDesc"></w2:label>
									<w2:value ref="insPlanNo"></w2:value>
									<w2:depth ref="depth"></w2:depth>
									<w2:folder ref=""></w2:folder>
									<w2:checkbox ref=""></w2:checkbox>
									<w2:checkboxDisabled ref=""></w2:checkboxDisabled>
									<w2:image ref=""></w2:image>
									<w2:iconImage ref=""></w2:iconImage>
									<w2:selectedImage ref=""></w2:selectedImage>
									<w2:expandedImage ref=""></w2:expandedImage>
									<w2:leafImage ref=""></w2:leafImage>
								</w2:itemset>
							</w2:treeview>
						</xf:group>
					</xf:group>
					<xf:group class="r">
						<xf:group class="outline_myplan">
							<w2:gridView ignoreCellClick="true"
								ev:onrowindexchange="" autoFit="allColumn" rowStatusWidth="20"
								visibleRowNum="" class="cm_grid" wheelRows="" ev:onviewchange=""
								fixedColumnWithHidden="" dataList="PlanTrtyListVo" id=""
								style="height:328px;" scrollByColumn="false" useShiftKey="true"
								rowStatusVisible="" ev:onafteredit="" rowStatusHeaderValue="상태"
								ev:oncellclick="" rowNumVisible="" rowNumWidth="10">
								<w2:caption id="caption1" style=""
									value="this is a grid caption.">
								</w2:caption>
								<w2:header id="header1" style="">
									<w2:row id="row1" style="">
										<w2:column blockSelect="false"
											id="column9" inputType="text" width="0" displayMode="label"
											value="특약코드">
										</w2:column>
										<w2:column blockSelect="false"
											id="column7" inputType="text" width="*" displayMode="label"
											value="특약명">
										</w2:column>
										<w2:column blockSelect="false"
											id="column5" inputType="text" width="100" displayMode="label"
											value="특약가입금액">
										</w2:column>
										<w2:column blockSelect="false"
											id="column3" inputType="text" width="0" displayMode="label"
											value="특약순서">
										</w2:column>
										<w2:column blockSelect="false"
											id="column1" width="0" inputType="text" displayMode="label"
											value="화면표시여부">
										</w2:column>
									</w2:row>
								</w2:header>
								<w2:gBody id="gBody1" style="">
									<w2:row id="row2" style="">
										<w2:column blockSelect="false"
											id="trtyCd" inputType="text" width="0" displayMode="label">
										</w2:column>
										<w2:column blockSelect="false"
											id="trtyName" inputType="text" width="*" displayMode="label"
											textAlign="left">
										</w2:column>
										<w2:column blockSelect="false"
											id="trtyInsAmt" inputType="select" width="100"
											displayMode="label" displayFormat="#,###" textAlign="right"
											allOption="" chooseOption="">
											<w2:choices>
												<w2:itemset
													nodeset="data:PlanTrtyInsAmtComVo">
													<w2:label
														ref="hnglCdName">
													</w2:label>
													<w2:value
														ref="engCdName">
													</w2:value>
												</w2:itemset>
											</w2:choices>
										</w2:column>
										<w2:column blockSelect="false"
											id="trtyOrdr" inputType="text" width="0"
											displayMode="label">
										</w2:column>
										<w2:column blockSelect="false"
											id="scrnIndcYn" width="0" inputType="text"
											displayMode="label">
										</w2:column>
									</w2:row>
								</w2:gBody>
							</w2:gridView>
						</xf:group>
					</xf:group>
				</xf:group>

			</xf:group>
			<!-- group:e -->

			<!-- group:s -->
			<xf:group id="" style="" class="bluebox">
	    			<xf:group id="" style="" class="box_wrap">
	    			<!-- <xf:group id="" style="" class="fl">
	    				<w2:anchor id="" ev:onclick="" class="btn_doc" outerDiv="false">
							<xf:label><![CDATA[상품문서]]></xf:label>
						</w2:anchor>
	    			</xf:group> -->
	    			<xf:group id="" style="" class="fl">
	    				<w2:textbox label="선택플랜" id=""
	    					class="txt_tit ml0" tagname="span">
	    				</w2:textbox>
	    				<xf:input disabled="true" id="id_planName"
	    					ref="" style="width:450px;">
	    				</xf:input>
	    				<xf:input disabled="true" id="id_insPlanNo" ref=""
	    					style="width:205px;display: none;">
	    				</xf:input>
	    			</xf:group>
	    			<xf:group id="" style="" class="fr">
	    				<w2:anchor class="btn_nml1 bul" ev:onclick="scwin.id_confirm_onclick" id="id_confirm" outerDiv="true">
							<xf:label><![CDATA[선택]]></xf:label>
						</w2:anchor>
	    				<w2:anchor class="btn_nml1 bul" ev:onclick="scwin.id_delete_onclick" id="id_delete" outerDiv="true">
							<xf:label><![CDATA[삭제]]></xf:label>
						</w2:anchor>
	    			</xf:group>
    			</xf:group>
    		</xf:group>
			<!-- group:e -->
		</xf:group>
	</body>
</html>