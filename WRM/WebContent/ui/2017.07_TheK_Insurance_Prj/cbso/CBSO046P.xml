<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
            	<w2:dataList baseNode="list" id="ds_getDepartList"
            		repeatNode="map">
            		<w2:columnInfo>
            			<w2:column id="sTeamCode" name="name1"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sLevel" name="name2"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sTeamName" name="name3"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sCenterCode" name="name4"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sCenterName" name="name5"
            				dataType="text">
            			</w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList baseNode="list" id="ds_sLavel"
            		repeatNode="map">
            		<w2:columnInfo>
            			<w2:column dataType="text" id="code"
            				name="code" />
            			<w2:column dataType="text" id="text"
            				name="text" />
            		</w2:columnInfo>
            		<w2:data use="true">
            			<w2:row>
            				<code><![CDATA[4]]></code>
            				<text><![CDATA[부/실]]></text>
            			</w2:row>
            			<w2:row>
            				<code><![CDATA[5]]></code>
            				<text><![CDATA[센터/팀]]></text>
            			</w2:row>
            			<w2:row>
            				<code><![CDATA[6]]></code>
            				<text><![CDATA[보상팀]]></text>
            			</w2:row>
            		</w2:data>
            	</w2:dataList>
            	<w2:dataList baseNode="list" id="dsWs_getDepartList"
            		repeatNode="map" userData2="//*/vector/data/ADMAC01">
            		<w2:columnInfo>
            			<w2:column id="sTeamCode" name="name1"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sLevel" name="name2"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sTeamName" name="name3"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sCenterCode" name="name4"
            				dataType="text">
            			</w2:column>
            			<w2:column id="sCenterName" name="name5"
            				dataType="text">
            			</w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            	<w2:dataList id="WARNING" baseNode="list"
            		saveRemovedData="true" repeatNode="map">
            		<w2:columnInfo>
            			<w2:column id="msg" name="name1"
            				dataType="text">
            			</w2:column>
            			<w2:column id="level" name="name2"
            				dataType="text">
            			</w2:column>
            			<w2:column id="detail" name="name3"
            				dataType="text">
            			</w2:column>
            			<w2:column id="timestamp" name="name4"
            				dataType="text">
            			</w2:column>
            		</w2:columnInfo>
            	</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
 <script src="/cm/js/convertJs/Global_Script.js"/>
 <script src="/cm/js/convertJs/comm_Webservice.js"/>        
        <script><![CDATA[

var gsDeptCode = "";

var gsLevel = "";

var gsDate = "";
var fv_args;
/**
 * @tab			   tab0, tab1
 * @author         장현
 * @function       doInit
 * @desc           가상계좌출금한도조회 화면을 초기화한다. 
 * @param
 * @return
 **/
scwin.init = function() {
	var pro = Promise.resolve();
		window.top.util.winTopShowModalChk = "T";
		util.winTopShowModal();
	pro = pro.then(function(rv) {
    	return util.winTopShowModalPromise();
	}); 
	pro = pro.then(function(rv) {
     //init 부분 함수 입력하는곳
	wprom.setPopupInit(562,380, "부서목록");	
	var indata = $w.getParameter("param");//
	try {
		fv_args = JSON.parse(indata);
	} catch(e) {
	};
	
    //Parent에서 넘어온 값을 설정한다.
    gsDeptCode = fv_args.sDeptCode;
    gsLevel = fv_args.sLevel;
    gsDate = fv_args.sDate;

    //조회조건에 Opener에서 넘어온 변수를 설정한다.
    scwin.setOpenerValues();
    
    return ;		// init 함수를 종료하고자 할때 사용
		// return Promise.reject("오류관련처리"); 
	});
	pro = pro.then(function(rv) {
		util.winTopHideModal();
	});	
	pro = pro.catch(function(rj) {
		util.winTopHideModal();
		//alert(rj); //Promise reject 시 처리 "오류관련처리" 값출력
	});	 
	return pro; 
};

/**
 * @tab
 * @author          장현
 * @function        setOpenerValues
 * @desc            opener에서 받은 파라미터를 읽어서 조회조건에 설정한다. 
 * @param
 * @return
 **/

scwin.setOpenerValues = function(e) {
    //Opener에서 넘어온 변수 설정한다.
    if (wconv.length(gsDate) == 8) {
        cal_sBaseDate.setValue(gsDate);
    } else {
        cal_sBaseDate.setValue(wconv.today());
    }
    if (wconv.length(gsDeptCode) == 7) {
        edt_sCenterCode.setValue(gsDeptCode);
    }
    
    /* 2012-02-13 서영지. 조직개편관련 레벨 수정
    if(gsLevel == "4"){
        rad_sLevel.Value = "4";
    }else {
        rad_sLevel.Value = "3";
    }*/
    if (gsLevel == "4") {
        rad_sLevel.setValue("4");
    } else if (gsLevel == "6") {
        rad_sLevel.setValue("6");
    } else {
        rad_sLevel.setValue("5");
    }


    //부서코드를 조회한다.
     scwin.lfn_Search_Async();
};

/**
 * @tab           
 * @author          장현
 * @function        getDepartList
 * @desc            팀단위의 부서리스트를 얻는다.
 * @task            AdminTask
 * @action          selectTeamDepart
 * @callback        _getDepartList
 */
 scwin.lfn_Search_Async = function() {
	util.eventAsyncCall(this, scwin.getDepartList, arguments);
};
scwin.getDepartList = function() {
    //필수 입력사항을 확인한다.
    if (!scwin.checkValues4Select()) {
        return;
    }  
    wconv.clear(dsWs_getDepartList);
    /*
    ServiceObject0.WSDL = gds.gWsdlAdmin;
    var MethodObj = gfn_CreateMethodObj(ServiceObject0, "AdminTask", "getNewDepartbyLevel");
    gfn_SetParam(MethodObj, "sBaseDate", cal_sBaseDate.getValue());
    gfn_SetParam(MethodObj, "sLevel", rad_sLevel.getValue());
    gfn_SetParam(MethodObj, "sCenterCode", edt_sCenterCode.getValue());
    gfn_SetParam(MethodObj, "sCenterName", edt_sCenterName.getValue());
    gfn_CallService(ServiceObject0, do_getDepartList, MethodObj);
    */
	var MethodObj = new callService("com.inswave.admin.task.AdminTask", "getNewDepartbyLevel");
	MethodObj.setId("getNewDepartbyLevel");
	//MethodObj.setParam("sAgentCode", gUserID);
    MethodObj.setParam( "sBaseDate", cal_sBaseDate.getValue());
    MethodObj.setParam( "sLevel", rad_sLevel.getValue());
    MethodObj.setParam( "sCenterCode", edt_sCenterCode.getValue());
    MethodObj.setParam( "sCenterName", edt_sCenterName.getValue());
	MethodObj.setUrl("/common/CBSO046PController.do");//배포후변경할것
	MethodObj.setXPath("//*/vector/data/ADMAC01");
	MethodObj.addXPath("//*/WARNING");
	MethodObj.sync();
	MethodObj.send();
	
	//util.interfaceKey(_tranSync.result.serviceDs);
	//dsWs_getDepartList.setJSON (_tranSync.getDsJson("ADMAC01")); // dataset 데이터
	util.jSonDsCreate(_tranSync.getDsJson("ADMAC01"), "dsWs_getDepartList");
	util.jSonDsCreate(_tranSync.getDsJson("ADMAC01"), "ds_getDepartList");
	util.setCompBindRefresh("dsWs_getDepartList");
	util.setCompBindRefresh("ds_getDepartList");
	util.setRowPosition(dsWs_getDepartList, 0);	
	
	//    
    scwin._getDepartList();
};

/**
 * @author          장현
 * @function        _getDepartList
 * @desc            팀단위의 부서리스트를 얻는다.
 * @param           result    부서리스트 
 * @xsl        
 */
scwin._getDepartList = function() {
    var listCount = dsWs_getDepartList.getRowCount();
    wconv.clear(ds_getDepartList);
    if (listCount < 1) {
        wprom.alert("조회된 자료가 없습니다.");
        return;
    } else {
        wconv.copy(ds_getDepartList, dsWs_getDepartList);
    }
};

/**
 * @tab
 * @author         장현
 * @function       checkValues4Select
 * @desc           필수 입력사항을 확인한다.
 * @param
 * @return          true/false
 **/
scwin.checkValues4Select = function() {
    if (cal_sBaseDate.getValue() == "") {
        wprom.alert("기준일자를 입력하세요.");
        return false;
    }
    return true;
};

//**************************************************************************************************
// 닫기
//**************************************************************************************************
scwin.Btn_Close_OnClick = function(e) {
    wprom.close();
};

//**************************************************************************************************
// 그리드 선택
//**************************************************************************************************
scwin.Grid1_OnCellClick = function(row, col) {
    var sArg;
    if (col == 0 || col == 2) {
        if (wconv.length(ds_getDepartList.getCellData(row, "sTeamCode")) == 0) {
            if (col == 0) {
                sArg = ds_getDepartList.getCellData(row, "sCenterCode");
                sArg += "^" + ds_getDepartList.getCellData(nRow, "sCenterName");
            }
        } else {
            if (col == 2) {
                sArg = ds_getDepartList.getCellData(row, "sTeamCode");
                sArg += "^" + ds_getDepartList.getCellData(row, "sTeamName");
            }
        }
        wprom.close(sArg);
    }
};

scwin.Cal_sBaseDate_OnFocus = function(obj) {
    gfn_Cal_OnFocus(obj);
};
]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="3501"
        	style="position:absolute; WorkArea:true; left:0px; top:0px;"
        	userData1="부서목록 "
        	userData2=" OnLoadCompleted:scwin.OnLoadCompleted; ">
        	<DataObjects>
        		<DataObject />
        	</DataObjects>
        	<ServiceObjects>
        		<ServiceObject />
        	</ServiceObjects>
        	<xf:trigger class="popup_top_btn"
        		ev:onclick="scwin.Btn_Close_OnClick" id="Btn_Close"
        		style="position:absolute; ImageID:btn_Comm_Close;left:481px;top:0px;"
        		tabIndex="3" type="anchor">
        		<xf:label><![CDATA[닫기]]></xf:label>
        	</xf:trigger><xf:group arcsize="6" class="search_area" id="Shape9" style="left:0px;top:30px;width:530px;height:60px;" userData3="RoundRect">
        	</xf:group>
        	<w2:textbox id="Static5" label="부서목록"
        		style="position:absolute; VAlign:Middle;  height:22px; left:0px; top:0px; width:141px;"
        		tagname="" class="sub_pop_title01" />
        	<w2:textbox class="sty_lb_Search_ness" id="Static0" label="기준일자"
        		style="position:absolute;height:20px;width:70px;left:3px;VAlign:Middle;top:38px;"
        		tagname="" />
        	<w2:textbox class="sty_lb_Search" id="Static6" label="조직코드"
        		style="position:absolute;height:20px;width:70px;left:8px;VAlign:Middle;top:61px;"
        		tagname="" />
        	<w2:textbox class="sty_lb_Search" id="Static7" label="조직명"
        		style="position:absolute;height:20px;width:53px;left:186px;VAlign:Middle;top:61px;"
        		tagname="" />
        	<w2:inputCalendar class="sty_ipt_search"
        		ev:onfocus="scwin.Cal_sBaseDate_OnFocus" id="cal_sBaseDate"
        		style="position:absolute; SundayTextColor:red;  SaturdayTextColor:blue;  border-style:solid;  height:20px;left:73px;top:38px; width:105px;"
        		tabIndex="5" validCheck="true" />
        	<xf:input class="sty_ipt_search" id="edt_sCenterCode"
        		style="position:absolute; border-style:solid;  height:20px;left:73px;top:61px; width:105px;"
        		tabIndex="4" />
        	<xf:select1 appearance="full" class="sty_ipt_search"
        		cols="3" ev:onclick="scwin.getDepartList" id="rad_sLevel"
        		rows="1" selectedIndex="1"
        		style="position:absolute; ColumnCount:3;  height:20px;left:252px;top:38px;"
        		tabIndex="6" userData1="3">
        		<xf:choices>
        			<xf:itemset nodeset="data:ds_sLavel">
        				<xf:label ref="text" />
        				<xf:value ref="code" />
        			</xf:itemset>
        		</xf:choices>
        		<Layout />
        		<Layout />
        		<Layout />
        	</xf:select1>
        	<w2:textbox class="sty_lb_Search" id="Static1" label="조직레벨"
        		style="position:absolute;height:20px;width:55px;left:186px;VAlign:Middle;top:38px;"
        		tagname="" />
        	<xf:input class="sty_ipt_search" id="edt_sCenterName"
        		style="position:absolute; border-style:solid;  height:20px;left:252px;top:61px; width:181px;"
        		tabIndex="12" />
        	<xf:switch id="switch_80" style=" ">
        		<xf:case id="Default_81" style=" ">
        			<w2:gridView autoFit="allColumn"
        				autoFitMinWidth="100" class="sty_Grid"
        				dataList="ds_getDepartList"
        				ev:oncellclick="scwin.Grid1_OnCellClick" focusMode="row"
        				id="Grid1" inputType="text" readOnly="true"
        				style="position:absolute; UseDBuff:true;  InputPanel:FALSE;  EndLineColor:default;  border:Flat;  height:222px; left:0px; right:426px;top:95px;width:530px;"
        				tabIndex="13">
        				<w2:header>
        					<w2:row>
        						<w2:column colSpan="2" dataType="text"
        							id="head_id_610" inputType="text" readOnly="true"
        							style="height:30px;" textAlign="center" userData1="0"
        							userData3="0" value="부실/센터/팀코드" width="200" />
        						<w2:column colSpan="2" dataType="text"
        							id="head_id_611" inputType="text" readOnly="true"
        							style="height:30px;" userData1="2" userData3="0"
        							value="보상팀" width="200" />
        					</w2:row>
        				</w2:header>
        				<w2:gBody>
        					<w2:row>
        						<w2:column dataType="text"
        							id="sCenterCode" inputType="link" readOnly="true"
        							style="height:27px; cursor:hand; " textAlign="center"
        							userData1="0"
        							userData2=" expr:decode(sTeamCode,&quot;&quot;,&quot;굴림,9,bold,Underline&quot;,&quot;&quot;) ;"
        							userData3="0" width="80" />
        						<w2:column dataType="text"
        							id="sCenterName" inputType="text" readOnly="true"
        							style="" userData1="1" userData3="0" width="120" />
        						<w2:column dataType="text"
        							id="sTeamCode" inputType="link" readOnly="true" style=""
        							textAlign="center" userData1="2"
        							userData2=" expr:decode(sTeamCode,&quot;&quot;,&quot;&quot;,&quot;굴림,9,bold,Underline&quot;) ;"
        							userData3="0" width="80" />
        						<w2:column dataType="text"
        							id="sTeamName" inputType="text" readOnly="true" style=""
        							userData1="3" userData3="0" width="120" />
        					</w2:row>
        				</w2:gBody>
        			</w2:gridView>
        		</xf:case>
        	</xf:switch>
        	<xf:trigger class="btn_Comm_Search"
        		ev:onclick=" scwin.lfn_Search_Async" id="Btn_Search"
        		style="position:absolute; ImageID:btn_Comm_Search;  height:20px;left:461px;top:58px; width:45px;"
        		tabIndex="14" type="anchor">
        		<xf:label><![CDATA[조회]]></xf:label>
        	</xf:trigger>
        	
        </xf:group>
    </body>
</html>
