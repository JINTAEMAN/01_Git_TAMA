<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
                <w2:dataList baseNode="list" id="DsWs_Cnt"
                	repeatNode="map"
                	userData2="//*/hashtable/data/LTICA01Count">
                	<w2:columnInfo>
                		<w2:column id="nCount" name="name1"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="DsWs_List"
                	repeatNode="map"
                	userData2="//*/hashtable/data/vector/data/LTICA01">
                	<w2:columnInfo>
                		<w2:column id="sCheck" name="name1"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sMainCode" name="name2"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sShortName" name="name3"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
                <w2:dataList baseNode="list" id="DsWs_Warning"
                	repeatNode="map" userData2="//*/WARNING">
                	<w2:columnInfo>
                		<w2:column id="msg" name="name1"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        
		<script src="/cm/js/convertJs/comm_Webservice.js"/>
		<script src="/cm/js/convertJs/LongTerm_Script.js"/>
		<script src="/cm/js/convertJs/Global_Script.js"/>
		
        <script><![CDATA[
/****************************************************************************
 * 프로그램번호   : A105_Pop
 * 프로그램명     : 국적검색 팝업
 * 파일명         : A105_Pop.xml
 * 프로그램 내용  : 국적검색한다.
 * 관련 프로그램  : 
 * 작성자         : 김용석 
 * 작성일         : 2010-11-09
 * 저작권         : Copyright ⓒ 2004. the K 손해보험㈜. All Right Reserved.
 * 변경내역       : 
 ****************************************************************************/


 //  #include "Script::Global_Script.js"
 //  #include "Script::comm_Webservice.js"

var pageSize = "10";
var pageCount = "10";

var sPsnCorpFlag;
var sCdNameFlag;
var sSerchKey;

//---------------------------------------------------------------------------
// function 명 : lfn_OnLoadCompleted lfn_A105_Pop_OnLoadCompleted->init
// 내용        : 폼로드할때 처리할 내용 
//---------------------------------------------------------------------------
scwin.init = function()
{
	//cbs - inparam 처리
	var indata = $w.getParameter("param");

	if (indata != null && indata != "") {
		var inJSON = JSON.parse(indata);
	
		console.log("==CBSO027P popup indata \n"+indata);		
	
		sCdNameFlag = inJSON.sCdNameFlag;
		sSerchKey = inJSON.sSerchKey;
	
		if(wconv.length(sCdNameFlag) > 0){
			Cmb_CdNameFlag.setValue(sCdNameFlag);
		} else {
			Cmb_CdNameFlag.setValue("Name");
		}
		
		if(wconv.length(sSerchKey) > 0){
			Edt_SerchChr.setValue(sSerchKey);
		}
	}
};
//---------------------------------------------------------------------------
// function 명 : lfn_Search
// 내용        : 조회버튼  이벤트 처리
//---------------------------------------------------------------------------
scwin.lfn_Search_Async = function() { //완료
	util.eventAsyncCall(this, scwin.lfn_Search, arguments);
};
scwin.lfn_Search = function(obj)
{
	scwin.lfn_getSelectList("1");

	// 페이징처리를 위해 전체 총데이터수를 구한다.
	gfn_MakePagingData(Ds_Page, DsWs_Cnt.getCellData(0, "nCount"), pageSize, pageCount);
	Cmb_Page.setValue("1");
};
//---------------------------------------------------------------------------
// function 명 : lfn_getSelectList
// 내용        : 리스트 조회
//---------------------------------------------------------------------------
scwin.lfn_getSelectList = function(pageNo) 
{
	DsWs_List.removeAll();//리스트 내용삭제

/* OLD S			
	SOBJ_List.WSDL = gWsdlBasis;	// 서비스 Obj WSDC 설정
	var MethodObj = gfn_CreateMethodObj(SOBJ_List, "com.inswave.longterm.cst.cst.task.CAA105Task", "selectList", pageSize, pageNo);
	
	gfn_SetParam(MethodObj, "sCdNameFlag", trim(Cmb_CdNameFlag.Value));
	gfn_SetParam(MethodObj, "sSerchKey", trim(Edt_SerchChr.Value));

	var result = gfn_CallService(SOBJ_List, DOBJ_List, MethodObj); 
	
	trace("-------"+DsWs_List.SaveXML());
	trace("-------"+DsWs_Cnt.SaveXML());	
OLD E */

	var MethodObj = new callService("com.inswave.longterm.cst.cst.task.CAA105Task", "selectList", pageSize, pageNo);
	MethodObj.setId("selectList");
	MethodObj.setParam("sCdNameFlag", wconv.trim(Cmb_CdNameFlag.getValue()));
	MethodObj.setParam("sSerchKey", wconv.trim(Edt_SerchChr.getValue()));
	MethodObj.setUrl("/common/CBSO027PController.do");
	MethodObj.setXPath("//*/hashtable/data/LTICA01Count");
	MethodObj.addXPath("//*/hashtable/data/vector/data/LTICA01");		
	MethodObj.addXPath("//WARNING");
	MethodObj.sync();
	MethodObj.send();
	
	util.interfaceKey(_tranSync.result.serviceDs);
	DsWs_Cnt.setJSON(_tranSync.result.serviceDs.data[0].LTICA01Count);
	DsWs_List.setJSON(_tranSync.result.serviceDs.data[1].LTICA01);

	if (DsWs_Warning.getRowCount() != 0) {
		wprom.alert(DsWs_Warning.getCellData(0, "msg"));
		return;
	}
	
	if(DsWs_Cnt.getCellData(0,"nCount") == null || DsWs_Cnt.getCellData(0,"nCount") <= 0){
		wprom.alert("조회건이 없습니다.");
	}else{
		Stc_TotalCnt.setValue(DsWs_Cnt.getCellData(0,"nCount"));
	}
		
//cbs - 동적으로 column추가 지원안됨. DataList에 직접 해당 column추가(sCheck)		
//	DsWs_List.AddColumn("sCheck");
};

//**************************************************************************************************
// 페이징 처리 - 페이지 콤보 박스 obj,strCode,strText,nOldIndex,nNewIndex -> info
//**************************************************************************************************
scwin.Cmb_Page_OnChanged = function(info)
{
	//scwin.lfn_getSelectList(strCode);
	scwin.lfn_getSelectList(info.newValue);
};

//**************************************************************************************************
// 페이징 처리 - 이전 페이지 리스트
//**************************************************************************************************
scwin.Btn_PreV_OnClick = function(e)
{
	var ftVal = wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowPosition(), "FILTERCD")) - 1;
    if (wconv.toNumber(maxFilterVal) < wconv.toNumber(ftVal)) {
        wprom.alert("조회의 처음입니다.");
        return;
    } else if (wconv.toNumber(ftVal) < 1) {
        wprom.alert("조회의 처음입니다.");
        return;
    }
    wconv.filter(Ds_Page, "FILTERCD=='" + ftVal + "'",true);
    Cmb_Page.setValue(Ds_Page.getCellData(0, "CODE"));
    scwin.lfn_getSelectList(Cmb_Page.getValue());
};
//**************************************************************************************************
// 페이징 처리 - 이전 페이지
//**************************************************************************************************
scwin.Btn_Pre_OnClick = function(e) {
    var Idx = Cmb_Page.getValue();
    if (wconv.toNumber(Idx) - 1 < 1) {
        wprom.alert("조회의 처음입니다.");
        return;
    }
    scwin.lfn_getSelectList(wconv.toString(wconv.toNumber(Idx) - 1));
    if (Ds_Page.getCellData(0, "CODE") == Idx) {
        wconv.filter(Ds_Page, "FILTERCD=='" + wconv.toString(wconv.toNumber(Ds_Page.getCellData(0, "FILTERCD")) - 1) + "'",true);
        Cmb_Page.setValue(Ds_Page.getCellData((Ds_Page.getRowCount() - 1), "CODE"));
    } else
        Cmb_Page.setValue(wconv.toNumber(Idx) - 1);
};
//**************************************************************************************************
// 페이징 처리 - 다음 페이지
//**************************************************************************************************
scwin.Btn_Next_OnClick = function(e) {
    var Idx = Cmb_Page.getValue();
    if (wconv.toNumber(maxPage) < wconv.toNumber(Idx) + 1) {
        wprom.alert("더이상 자료가 존재하지 않습니다");
        return;
    }
    scwin.lfn_getSelectList(wconv.toString(wconv.toNumber(Idx) + 1));
    if (Ds_Page.getCellData((Ds_Page.getRowCount() -1), "CODE") == Idx) {
        wconv.filter(Ds_Page, "FILTERCD=='" + wconv.toString(wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowCount() - 1, "FILTERCD")) + 1) + "'",true);
    }
    Cmb_Page.setValue(wconv.toNumber(Idx) + 1);
};
//**************************************************************************************************
// 페이징 처리 - 다음 페이지 리스트
//**************************************************************************************************
scwin.Btn_NextV_OnClick = function(obj) {
    var ftVal = wconv.toNumber(Ds_Page.getCellData(Ds_Page.getRowPosition(), "FILTERCD")) + 1;
    if (wconv.toNumber(maxFilterVal) < wconv.toNumber(ftVal)) {
        wprom.alert("더이상 자료가 존재하지 않습니다");
        return;
    }
    wconv.filter(Ds_Page, "FILTERCD=='" + ftVal + "'",true);
    Cmb_Page.setValue(Ds_Page.getCellData(0, "CODE"));
    scwin.lfn_getSelectList(Cmb_Page.getValue());
};

//---------------------------------------------------------------------------
// function 명 : btn_close_OnClick
// 내용        : 닫기버튼 click event처리
//---------------------------------------------------------------------------
scwin.btn_close_onclick = function(e) 
{
	wprom.close(false);
};

//---------------------------------------------------------------------------
// function 명 : lfn_btn_ok_OnClick
// 내용        : 확인버튼 클릭 이벤트 
//---------------------------------------------------------------------------
scwin.btn_ok_onclick = function(e)
{
	var nRowPos = -1;
	for(var i=0 ; i < DsWs_List.getRowCount() ; i++){
		if(DsWs_List.getCellData(i,"sCheck") == "1"){
			nRowPos = i;
			break;
		}
	}
	
	if(nRowPos == -1){
		wprom.alert("원하는 항목을 선택하세요");
		return;
	}
	
	var sNtnlCd = DsWs_List.getCellData(nRowPos,"sMainCode");
	var sNtnlName = DsWs_List.getCellData(nRowPos,"sShortName");
	
	wprom.close(sNtnlCd+"^"+sNtnlName);
};

//---------------------------------------------------------------------------
// function 명 : lfn_Grd_List_OnCellClick
// 내용        :  조회화면 그리드 셀클릭 이벤트 
//---------------------------------------------------------------------------
scwin.Grd_List_oncellclick = function(row,col)
{
	for(var i=0 ; i < DsWs_List.getRowCount() ; i++){
		DsWs_List.setCellData(i,"sCheck","0");
	}
	
	DsWs_List.setCellData(row,"sCheck","1");	
};

//---------------------------------------------------------------------------
// function 명 : lfn_Grd_List_OnCellDblClick
// 내용        :  조회화면 그리드 셀더블클릭 이벤트 
//---------------------------------------------------------------------------
scwin.Grd_List_oncelldblclick = function(row,col)
{
	scwin.Grd_List_oncellclick(row, col);
	scwin.btn_ok_onclick();
};
//---------------------------------------------------------------------------
// function 명 : lfn_Edt_SerchChr_OnKeyDown
// 내용        :  국가명, 국가코드 입력 후  엔터 이벤트
//---------------------------------------------------------------------------
scwin.Edt_SerchChr_onkeydown = function(e)
{
	if (e.keyCode == 13) {
		scwin.lfn_Search_Async();
	}
};
/*
//---------------------------------------------------------------------------
// function 명 : lfn_Cmd_PsnCorpFlag_OnKeyDown
// 내용        : 개인/법인 구분콤보 선택 후 엔터 이벤트
//---------------------------------------------------------------------------
function lfn_Cmd_PsnCorpFlag_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,LLParam,HLParam)
{
	if(nChar == 13){
		lfn_Search(obj);
	}	
}

//---------------------------------------------------------------------------
// function 명 : lfn_Cmb_CdNameFlag_OnKeyDown
// 내용        : 주민번호/고객명 구분 콤보 선택 후 엔터 이벤트
//---------------------------------------------------------------------------
function lfn_Cmb_CdNameFlag_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,LLParam,HLParam)
{
	if(nChar == 13){
		lfn_Search(obj);
	}
}

//---------------------------------------------------------------------------
// function 명 : lfn_Edt_SerchCd_OnKeyDown
// 내용        : 주민번호 입력 후  엔터 이벤트
//---------------------------------------------------------------------------
function lfn_Edt_SerchCd_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if(nChar == 13){
		lfn_Search(obj);
	}
}
*/]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="A105_Pop"
            style="position:absolute; WorkArea:true;  Ver:1.0;  PidAttrib:7;  height:341px; left:0px; top:0px;"
            userData1="국적조회" userData2=" OnLoadCompleted:scwin.lfn_A105_Pop_OnLoadCompleted; ">
            <DataObjects>
                <DataObject/>
            </DataObjects>
            <ServiceObjects>
                <ServiceObject/>
            </ServiceObjects>
            <xf:group arcsize="6" class="search_area" id="Shape9" style="left:0px;top:30px;width:380px;" userData3="RoundRect">
            	</xf:group>
            <w2:textbox id="Static5" label="국적조회" style="position:absolute; VAlign:Middle;  height:20px; left:0px; top:0px; width:73px;" tagname="" class="sub_pop_title01"/>
            <xf:input class="sty_ipt_search" ev:onblur="" id="Edt_SerchChr"
                style="position:absolute; border-style:solid;  height:20px;left:141px;top:38px; width:124px;" tabIndex="1" ev:onkeydown="scwin.Edt_SerchChr_onkeydown"/>
            <w2:textbox id="Static17" label="총 건 :" style="position:absolute; VAlign:Middle;  height:20px;left:1px;top:83px; width:36px;" tagname=""/>
            <w2:textbox id="Stc_TotalCnt" label="0"
                style="position:absolute; VAlign:Middle;  text-align:right; height:20px;left:39px;top:83px; width:28px;" tagname=""/>
            <w2:textbox id="Static1" label="건" style="position:absolute; VAlign:Middle;  height:20px;left:67px;top:83px; width:16px;" tagname=""/>
            <xf:select1 appearance="minimal" class="sty_ipt_search"
            	emptyItem="true" ev:onblur="" ev:onchange=""
            	id="Cmb_CdNameFlag"
            	style="position:absolute; Text:국적명;  ResetIndex:FIRST;  INDEX:0;  border-style:solid;  height:20px;left:9px;top:38px; width:125px;"
            	tabIndex="9" renderType="native" allOption=""
            	chooseOption="">
            	<Record />
            	<Record />
            	<xf:choices>
            		<xf:item>
            			<xf:label><![CDATA[국적코드]]></xf:label>
            			<xf:value><![CDATA[Cd]]></xf:value>
            		</xf:item>
            		<xf:item>
            			<xf:label><![CDATA[국적명]]></xf:label>
            			<xf:value><![CDATA[Name]]></xf:value>
            		</xf:item>
            	</xf:choices>
            </xf:select1>
            <xf:trigger class="btn_Comm_Search" ev:onclick="scwin.lfn_Search_Async" id="Button0"
                style="position:absolute; Transparent:TRUE;  ImageID:btn_Comm_Search;  height:20px;left:311px;top:37px;width:45px;" tabIndex="10" type="anchor">
                <xf:label><![CDATA[조회]]></xf:label>
            </xf:trigger>
            <w2:wframe id="div1" scope="false" src="/cm/common/Main_btn_GridControl.xml" style="position:absolute; height:20px;left:123px;top:74px; width:219px;"/>
            <xf:switch id="switch_69" style=" ">
                <xf:case id="Default_70" style=" ">
                    <w2:gridView autoFit="allColumn"
                    	autoFitMinWidth="100" class="sty_Grid"
                    	dataList="DsWs_List"
                    	ev:oncellclick="scwin.Grd_List_oncellclick"
                    	ev:oncelldblclick="scwin.Grd_List_oncelldblclick"
                    	focusMode="row" id="Grd_List" inputType="text"
                    	readOnly="true"
                    	style="position:absolute;UseDBuff:true;ScrollCell:true;InputPanel:FALSE;EndLineColor:default;border:Flat;AutoFitEndLine:Hide;height:267px;left:0px;right:339px;top:108px;width:380px;"
                    	tabIndex="12">
                    	<w2:header>
                    		<w2:row>
                    			<w2:column dataType="text"
                    				id="head_id_493" inputType="text"
                    				readOnly="true" rowSpan="2" userData1="0"
                    				userData3="0" value="선택" width="34" />
                    			<w2:column dataType="text"
                    				id="head_id_494" inputType="text"
                    				readOnly="true" rowSpan="2" userData1="1"
                    				userData3="0" value="국적코드" width="56" />
                    			<w2:column dataType="text"
                    				id="head_id_495" inputType="text"
                    				readOnly="true" rowSpan="2" userData1="2"
                    				userData3="0" value="국적명" width="*" />
                    		</w2:row>
                    		<w2:row />
                    	</w2:header>
                    	<w2:gBody>
                    		<w2:row>
                    			<w2:column dataType="text" id="sCheck"
                    				inputType="checkbox" readOnly="false"
                    				rowSpan="2" userData1="0" userData3="0"
                    				width="34" />
                    			<w2:column dataType="text"
                    				id="sMainCode" inputType="text" readOnly="true"
                    				rowSpan="2" textAlign="center" userData1="1"
                    				userData3="0" width="56" />
                    			<w2:column dataType="text"
                    				id="sShortName" inputType="text" readOnly="true"
                    				rowSpan="2" userData1="2" userData3="0"
                    				width="*" textAlign="left" />
                    		</w2:row>
                    		<w2:row />
                    	</w2:gBody>
                    </w2:gridView>
                </xf:case>
            </xf:switch>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.btn_ok_onclick" id="btn_ok"
                style="position:absolute; ImageID:btn_Comm_Confirmation;  height:20px;left:280px;top:0px;" tabIndex="14" type="anchor">
                <xf:label><![CDATA[확인]]></xf:label>
            </xf:trigger>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.btn_close_onclick" id="btn_close"
                style="position:absolute; ImageID:btn_Comm_Close;  height:20px;left:331px;top:0px;" tabIndex="13" type="anchor">
                <xf:label><![CDATA[닫기]]></xf:label>
            </xf:trigger>
        </xf:group>
    </body>
</html>
