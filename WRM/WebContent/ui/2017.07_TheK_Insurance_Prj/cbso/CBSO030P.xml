<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/new.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataMap baseNode="map" id="PossCstBussVo">
					<w2:keyInfo>
						<w2:key id="custNo" name="고객번호"
							dataType="text">
						</w2:key>
						<w2:key id="handlerID" name="취급자ID"
							dataType="text">
						</w2:key>
						<w2:key id="changeNo" name="변경회차"
							dataType="number">
						</w2:key>
						<w2:key id="last" name="최종여부"
							dataType="text">
						</w2:key>
						<w2:key id="birthDate" name="생년월일"
							dataType="text">
						</w2:key>
						<w2:key id="birthType" name="양력/음력구분"
							dataType="text">
						</w2:key>
						<w2:key id="weddingDate" name="결혼기념일"
							dataType="text">
						</w2:key>
						<w2:key id="anvsDate" name="관리기념일"
							dataType="text">
						</w2:key>
						<w2:key id="chidYn" name="자녀유무"
							dataType="text">
						</w2:key>
						<w2:key id="etcMemo" name="기타메모"
							dataType="text">
						</w2:key>
						<w2:key id="inputDate" name="입력일자"
							dataType="text">
						</w2:key>
						<w2:key id="inputTime" name="입력시간"
							dataType="text">
						</w2:key>
						<w2:key id="userID" name="사용자"
							dataType="text">
						</w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
			
		</xf:model>
		<script type="javascript"><![CDATA[
var sCustNo = "";
var handlerID = "";

	scwin.init = function() {
		var indata = $w.getParameter("param");
		var inJSON = JSON.parse(indata);

console.log("==CBSO030P popup open indata \n"+indata);		
		//indata set
		if (inJSON.sCustNo == "") {
	        id_etcMemo.setValue(inJSON.etcMemo);
			btn_confirm.setValue("확인");
		} else {
			sCustNo = inJSON.sCustNo;
			handlerID = inJSON.handlerID;
			
			PossCstBussVo.set("custNo", sCustNo);
			PossCstBussVo.set("handlerID", handlerID);
			
			var trans = new transSub();						// transaction 보낼 객체 생성
			trans.setId("retrievePossCstBuss");					// transaction 보낼 SubmissionID
			trans.setUrl("/common/CBSO0007.do");		// Controller 쪽으로 보낼 주소
			trans.setDs("PossCstBussVo");
			trans.targetDs("PossCstBussVo");
			trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
			trans.send();
		}
	};
	
	scwin.btn_confirm_onclick = function() {
		if (sCustNo == "") {
			scwin.rtnClosePopup();
		} else {
			if (PossCstBussVo.getModifiedKey().length > 0) {
				var trans = new transSub();						// transaction 보낼 객체 생성
				trans.setId("registerPossCstBuss");				// transaction 보낼 SubmissionID
				trans.setUrl("/common/CBSO0008.do");		// Controller 쪽으로 보낼 주소
				trans.setDs("PossCstBussVo");
				trans.targetDs("PossCstBussVo");
				trans.callBack("scwin.subCallBack");	// 받을 Dataset을 처리시 콜백함수
				trans.send();
			} else {
				scwin.rtnClosePopup();
			}
		}
	};
	
	scwin.subCallBack = function(e) {
		switch(e.subID){
			case "retrievePossCstBuss":
				if (e.flag == "s") {
					PossCstBussVo.setJSON(e.result);
					PossCstBussVo.reform();
					
				} else {
					wprom.alert(e.msg);
				}
				break;
				
			case "registerPossCstBuss":
				if (e.flag == "s") {
					PossCstBussVo.setJSON(e.result.possCstBussVo);
					scwin.rtnClosePopup();
				} else {
					wprom.alert(e.msg);
				}
				break;
		}
	};
	
	scwin.btn_cancel_onclick = function() {
		wprom.close();
	};
	
	scwin.rtnClosePopup = function() {
		var etcMemo = id_etcMemo.getValue();
		
		var rtnJSON = {	"etcMemo" : etcMemo};
		wprom.close(rtnJSON);
	}
	]]></script>
	</head>
	<body>
		<xf:group class="contentWrap layer" id="" style="">

			<!-- group:s -->
			<xf:group class="defaultbox" id="" style="">
				<xf:group class="fr" id="" style="">
					<w2:anchor class="btn_nml" ev:onclick="scwin.btn_confirm_onclick" id="btn_confirm"
						outerDiv="true">
						<xf:label><![CDATA[저장]]></xf:label>
					</w2:anchor>
					<w2:anchor class="btn_nml" ev:onclick="scwin.btn_cancel_onclick" id="btn_cancel"
						outerDiv="true" style="">
						<xf:label><![CDATA[취소]]></xf:label>
					</w2:anchor>
				</xf:group>
				<w2:textbox class="df_tt fl" id="" label="메모"
					style="">
				</w2:textbox>
			</xf:group>
			<xf:group id="" style="" class="section">
				<xf:textarea id="id_etcMemo" style="height:150px" ref="data:PossCstBussVo.etcMemo"></xf:textarea>
				
			</xf:group>
			<!-- group:e -->
			
			<!-- group:s -->
			<!-- group:e -->
			
		</xf:group>
	</body>
</html>