<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
            	<w2:dataList baseNode="list" id="DsWs_Auth"
            		repeatNode="map" userData2="/*//ADMAA04" />
            	<w2:dataList baseNode="list" id="DsWs_Pwd"
            		repeatNode="map" userData2="/*//ADMAB01" />
            	<w2:dataList baseNode="list" repeatNode="map"
            		id="WARNING" saveRemovedData="true">
            	</w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
 <script src="/cm/js/common.js"/>
 <script src="/cm/js/val_lib.js"/>
 <script src="/cm/js/util.js"/>
 <script src="/cm/js/transSub.js"/>
 <script src="/cm/js/callService.js"/>
 <script src="/cm/js/gds.js"/>
 <script src="/cm/js/wconv.js"/>
 <script src="/cm/js/wprom.js"/>
        <script><![CDATA[
/*
 *===================================File description=============================
 * Create Date : 2012-02-29 
 * Creater     : 서영지
 * Description : 카드 강제승인시 슈바 비밀번호 확인 화면
 *================================================================================
 */
var gsForceYN = "N";

//결과(Y:강제승인, N:강제승인불가)
//********************************************************************************
// OnLoadCompleted
//********************************************************************************
scwin.init = function() {
    scwin.initialize();
};

//****************************************************************************
//  화면 초기화
//****************************************************************************
scwin.initialize = function() {
    Edt_sEmpNo.setValue("");
    Edt_sPassword.setValue("");
};

//****************************************************************************
//  수납권한자인지 체크한다.
//****************************************************************************
scwin.Btn_Confirm_OnClick = function(obj) {
    scwin.getAuthID();
};

scwin.getAuthID = function() {
    if (Edt_sEmpNo.getValue() == "") {
        wprom.alert("'사원번호'를 입력해주십시오.");
        Edt_sEmpNo.focus();
        return;
    }
    if (Edt_sPassword.getValue() == "") {
        wprom.alert("'비밀번호'를 입력해주십시오.");
        Edt_sPassword.focus();
        return;
    }
    /* 
    SOBJ_Admin.WSDL = gds.gWsdlAdmin;
    wconv.clear(DsWs_Auth);
    var MethodObj = gfn_CreateMethodObj(SOBJ_Admin, "AdminTask", "selectForAuthCheck");
    gfn_SetParam(MethodObj, "sUserID", Edt_sEmpNo.getValue());
    gfn_SetParam(MethodObj, "nAuthID", 40001); //수납권한
    var result = gfn_CallService(SOBJ_Admin, DOBJ_Auth, MethodObj);
    */
    wconv.clear(DsWs_Auth);
    wconv.clear(WARNING);
	var MethodObj = new callService("com.inswave.admin.task.AdminTask", "selectForAuthCheck");
	MethodObj.setId("selectForAuthCheck");
	MethodObj.setParam("sUserID", Edt_sEmpNo.getValue());
	MethodObj.setParam("nAuthID", 40001); //수납권한	
	MethodObj.setUrl("/common/CBSO034PController.do");
	MethodObj.setXPath("/*//ADMAA04");
	MethodObj.addXPath("//WARNING");
	MethodObj.sync();
	MethodObj.send();
	//util.interfaceKey(_tranSync.result.serviceDs);
	//DsWs_Team.setJSON (_tranSync.getDsJson("ADMAC03")); // dataset 데이터 
	util.jSonDsCreate(_tranSync.getDsJson("ADMAA04"), "DsWs_Auth");
	util.jSonDsCreate(_tranSync.getDsJson("WARNING"), "WARNING");
	util.setCompBindRefresh("DsWs_Auth");
	util.setRowPosition(DsWs_Auth, 0);
    
    //trace(MethodObj.in0);		
    if (WARNING.getRowCount() != 0) {
        wprom.alert("웹서비스 이상입니다.");
        return;
    }

    //trace(DsWs_Auth.savexml());
    if (DsWs_Auth.getCellData(0, "result") == "0") {
        wprom.alert("수납권한자만 승인을 계속 진행할 수 있습니다.");
        return;
    } else {
        scwin.isCorrectPassword();
    }
};

//****************************************************************************
//  비밀번호가 정확한지 확인한다.
//****************************************************************************
scwin.isCorrectPassword = function() {
    wconv.clear(DsWs_Pwd);
    wconv.clear(WARNING);
    /*
    SOBJ_Accounting.WSDL = gds.gWsdlAccounting;
    var MethodObj = gfn_CreateMethodObj(SOBJ_Accounting, "AccountingCommonTask", "isCorrectPassword", "", "");
    gfn_SetParam(MethodObj, "sEmpNo", Edt_sEmpNo.getValue());
    gfn_SetParam(MethodObj, "sPassword", Edt_sPassword.getValue());
    var result = gfn_CallService(SOBJ_Accounting, DOBJ_Pwd, MethodObj);
    */
	var MethodObj = new callService("com.inswave.accounting.task.AccountingCommonTask", "isCorrectPassword");
	MethodObj.setId("isCorrectPassword");
	MethodObj.setParam("sEmpNo", Edt_sEmpNo.getValue());
	MethodObj.setParam("sPassword", Edt_sPassword.getValue());
	MethodObj.setUrl("/common/CBSO034PController.do");
	MethodObj.setXPath("/*//ADMAB01");
	MethodObj.addXPath("//WARNING");
	MethodObj.sync();
	MethodObj.send();
	//util.interfaceKey(_tranSync.result.serviceDs);
	//DsWs_Team.setJSON (_tranSync.getDsJson("ADMAC03")); // dataset 데이터 
	util.jSonDsCreate(_tranSync.getDsJson("ADMAB01"), "DsWs_Pwd");
	util.jSonDsCreate(_tranSync.getDsJson("WARNING"), "WARNING");
	util.setCompBindRefresh("DsWs_Pwd");
	util.setRowPosition(DsWs_Pwd, 0);
    
    //trace(DOBJ_Pwd.Contents);
    //trace(DsWs_Pwd.SaveXML());
    if (WARNING.getRowCount() != 0) {
        wprom.alert("웹서비스 이상입니다.");
        return;
    }
    if (DsWs_Pwd.getCellData(0, "sResult") == "N") {
        wprom.alert("비밀번호가 맞지 않습니다. 확인하십시오.");
        Edt_sPassword.setValue("");
        Edt_sPassword.focus();
        return;
    } else {
        gsForceYN = "Y";
        scwin.Btn_Close_OnClick();
    }
};

//****************************************************************************
//  닫기
//****************************************************************************
scwin.Btn_Close_OnClick = function(e) {
console.log(gsForceYN + "^" + Edt_sEmpNo.getValue());
	var rtn = gsForceYN + "^" + Edt_sEmpNo.getValue();
    wprom.close(rtn);
};
]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="9990_popup"
            style="position:absolute; WorkArea:true;  Ver:1.0;  PidAttrib:7;height:90px; left:0px; top:0px;"
            userData1="비밀번호확인" userData2=" OnLoadCompleted:scwin.OnLoadCompleted; ">
            <DataObjects>
                <DataObject/>
                <DataObject/>
            </DataObjects>
            <ServiceObjects>
                <ServiceObject/>
                <ServiceObject/>
            </ServiceObjects>
            <xf:group arcsize="6" class="sty_area_form" id="Shape2" style="position:absolute; right:736px;  bottom:608px; height:57px;left:0px;top:30px; width:332px;" userData3="RoundRect">
            		<xf:group class="form_w_line" id="" style="top:26px;">
            		</xf:group>
            	</xf:group><xf:group arcsize="8" class="" id="Shape5"
            	style="position:absolute;height:90px; left:0px; top:0px;width:311px;"
            	userData3="RoundRect">
            	
            </xf:group>
            <xf:input dataType="number" id="Edt_sEmpNo" maxlength="7"
                style="position:absolute; border-color:user9;  border-style:solid;  height:20px;left:118px;top:34px; width:206px;" tabIndex="1"/>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.Btn_Confirm_OnClick" id="Btn_Confirm"
                style="position:absolute; ImageID:btn_Comm_Input;  height:21px;left:232px;top:0px;" tabIndex="3" type="anchor">
                <xf:label><![CDATA[확인]]></xf:label>
            </xf:trigger>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.Btn_Close_OnClick" id="Btn_Close"
                style="position:absolute; ImageID:btn_Comm_Close;  height:21px;left:283px;top:0px;" tabIndex="4" type="anchor">
                <xf:label><![CDATA[닫기]]></xf:label>
            </xf:trigger>
            <w2:textbox id="Static5" label="비밀번호확인" style="position:absolute; VAlign:Middle;  height:20px; left:0px; top:0px; width:89px;" tagname="" class="sub_pop_title01"/>
            <w2:textbox class="sty_lb_Basic" id="Static29" label="사원번호"
                style="position:absolute; VAlign:Middle;left:0px;top:30px; width:95px; height:27px;" tagname=""/>
            <w2:textbox class="sty_lb_Basic" id="Static0" label="비밀번호"
                style="position:absolute;
 VAlign:Middle;left:0px;top:58px;
 width:95px;
 height:27px;" tagname=""/>
            <xf:secret id="Edt_sPassword"
                style="position:absolute; border-color:user9;  border-style:solid;  height:20px;left:118px;top:62px; width:206px;" tabIndex="2"/>
        </xf:group>
    </body>
</html>
