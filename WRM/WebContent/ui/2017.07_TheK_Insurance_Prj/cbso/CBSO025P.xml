<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/convert.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>DEFAULT</w2:type>
        <w2:buildDate/>
        <xf:model>
            <xf:instance>
                <data/>
            </xf:instance>
            <w2:dataCollection>
                <w2:dataList baseNode="list" id="DsWs_AddrHistory"
                	repeatNode="map" userData2="//*/vector/data/CUSAA02">
                	<w2:columnInfo>
                		<w2:column id="sZip2" name="name1"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sCustNo" name="name2"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrs3" name="name3"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrs2" name="name4"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrs1" name="name5"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrsAdd" name="name6"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrsType" name="name7"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAdrsAdd2" name="name8"
                			dataType="text">
                		</w2:column>
                		<w2:column id="nSeqNo" name="name9"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sLast" name="name10"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sZip1" name="name11"
                			dataType="text">
                		</w2:column>
                		<w2:column id="nAddrStdSeq" name="name12"
                			dataType="text">
                		</w2:column>
                		<w2:column id="nChangeNo" name="name13"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sOrgZipType" name="name14"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sZipType" name="name15"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sEmpName" name="name16"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sAddrMgtNo" name="name17"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sUserID" name="name18"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sInputTime" name="name19"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sOrgZipCode" name="name20"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sOrgAddr" name="name21"
                			dataType="text">
                		</w2:column>
                		<w2:column id="sInputDate" name="name22"
                			dataType="text">
                		</w2:column>
                	</w2:columnInfo>
                </w2:dataList>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
       
        <script src="/cm/js/convertJs/Global_Script.js"/>
        <script src="/cm/js/convertJs/comm_Webservice.js"/>
        
        <script><![CDATA[

 //  #include "Script::Global_Script.js"
 //  #include "Script::comm_Webservice.js"

/*
parentInfo 변수값 정의 

arg1^arg2^arg3^arg4^arg5^arg6^arg7^arg8^arg9^arg10^arg11^arg12^arg13^arg14^arg15

arg1  = custNo
arg2  = seqNo
arg3  = sAdrsType
arg4  = DataSet
arg5  = row
arg6  = column sZip1
arg7  = column sZip2
arg8  = column sAdrs1
arg9  = column sAdrs2
arg10 = column sAdrs3
arg11 = column sAdrsAdd
arg12 = column sAdrsAdd2
arg13 = column sAdrs
arg14 = ChangeNo  -- 2008.08.20일 추가사항 
arg15 = 포커스 이동할 컴포넌트
*/

var parentInfo;
var args;
var sHandlerID;	//취급자사번

	scwin.init = function() {
		//cbs - inparam 처리
		var indata = $w.getParameter("param");
		var inJSON = JSON.parse(indata);

		console.log("==CBSO025P popup indata \n"+indata);		
		
		sHandlerID = inJSON.sHandlerID;
		
		// 파라미터로 넘어온 값을 split
		args = inJSON.parentInfo.split("^");
		
		var pro = Promise.resolve();
		pro = pro.then(function(rv) {
		  return util.winTopShowModalPromise();
		});
		pro = pro.then(function(rv) {
			if (args.length > 1 && wconv.length(wconv.trim(args[0])) > 0 && wconv.length(wconv.trim(args[1])) > 0 && wconv.length(wconv.trim(args[2])) > 0) {
				scwin.search(wconv.trim(args[0]), wconv.trim(args[1]), wconv.trim(args[2]));
			} else {
				wprom.alert("검색 조건이 없습니다. 확인후 다시 시도해 주세요.");
			}
		});
    
	    pro = pro.then(function(rv) {
	 		util.winTopHideModal();
		});	
		
		return pro;
	};
			
/**
 * @author      곽성실     
 * @function	search
 * @desc		고객 주소 History 검색
 * @param		custNo		: 주민등록번호/사업자 번호
 * 				seqNo		: 순번
 * 				adrsType	: 주소 구분
 **/

	scwin.search = function(custNo, seqNo, adrType) {
/* OLD S	
		// Dataset 초기화
	DsWs_AddrHistory.Clear();
	SOBJ_control.WSDL = gWsdlGen;	// 서비스 Obj WSDC 설정
	var MethodObj = gfn_CreateMethodObj(SOBJ_control, "com.inswave.customer.task.CustTask", "getAdrListByType", 0, 0);
				    
	// 주민등록번호/사업자번호, 순번 세팅
	gfn_SetParam(MethodObj, "sCustNo", custNo);
	gfn_SetParam(MethodObj, "nSeqNo", seqNo);
	gfn_SetParam(MethodObj, "sAdrsType", adrType);
	
	gfn_CallService(SOBJ_control, DOBJ_control, MethodObj);
OLD E */	

	//trace(DsWs_AddrHistory.SaveXML());

		//cbs - getAdrListByType -> getHandlersAdrsHistory
		//var MethodObj = new callService("com.inswave.customer.task.CustTask", "getAdrListByType", 0, 0);
		var MethodObj = new callService("com.inswave.customer.task.CustTask", "getHandlersAdrsHistory", 0, 0);
		MethodObj.setId("getHandlersAdrsHistory");
		MethodObj.setParam("sCustNo", custNo);
		MethodObj.setParam("nSeqNo", seqNo);
		MethodObj.setParam("sAdrsType", adrType);
		MethodObj.setParam("sHandlerID", sHandlerID);
		MethodObj.setUrl("/common/CBSO025PController.do");
		MethodObj.setXPath("//*/vector/data/CUSAA02");
		MethodObj.addXPath("//WARNING");
		MethodObj.sync();
		MethodObj.send();
		
		util.interfaceKey(_tranSync.result.serviceDs);
		DsWs_AddrHistory.setJSON(_tranSync.result.serviceDs.data[0].CUSAA02);
	};

	//Gri_AddrHistory customFormatter
	scwin.setDisplayGriAddrHistory = function(data, formattedData, rowIndex, colIndex) {
		if (Gri_AddrHistory.getColumnID(colIndex)  == "id_disAddr") {
			return DsWs_AddrHistory.getCellData(rowIndex, "sAdrs1") + " " +
					DsWs_AddrHistory.getCellData(rowIndex, "sAdrs2") + " " +
					DsWs_AddrHistory.getCellData(rowIndex, "sAdrs3") + " " +
					DsWs_AddrHistory.getCellData(rowIndex, "sAdrsAdd") + " " +
					DsWs_AddrHistory.getCellData(rowIndex, "sAdrsAdd2");
		 } else if (Gri_AddrHistory.getColumnID(colIndex)  == "id_inputTime") {
		 	return wconv.left(DsWs_AddrHistory.getCellData(rowIndex, "sInputTime"),2)+ ":"+
		 			wconv.mid(DsWs_AddrHistory.getCellData(rowIndex, "sInputTime"),2,2);
		 }
	};
	
	scwin.Btn_Close_onclick = function(e) {
		wprom.close();
	};
	
	scwin.Gri_AddrHistory_oncelldblclick = function(row,col) {
		var pDataSetName = wconv.trim(args[3]);
		var pDataSetRow  = wconv.trim(args[4]);
		var rtnJSON = {};
		
		if (wconv.length(pDataSetName) > 0 && wconv.length(pDataSetRow) > 0) {
			// 보모창의 해당 값을 세팅
			//cbs - 부모창 접근 불가 DS return
			if (wconv.length(wconv.trim(args[5])) > 0) rtnJSON[wconv.trim(args[5])] = DsWs_AddrHistory.getCellData(row, "sZip1");
			if (wconv.length(wconv.trim(args[6])) > 0) rtnJSON[wconv.trim(args[6])] = DsWs_AddrHistory.getCellData(row, "sZip2");
			
			if (wconv.length(wconv.trim(args[7])) > 0) rtnJSON[wconv.trim(args[7])] = DsWs_AddrHistory.getCellData(row, "sAdrs1");			
			if (wconv.length(wconv.trim(args[8])) > 0) rtnJSON[wconv.trim(args[8])] = DsWs_AddrHistory.getCellData(row, "sAdrs2");
			if (wconv.length(wconv.trim(args[9])) > 0) rtnJSON[wconv.trim(args[9])] = DsWs_AddrHistory.getCellData(row, "sAdrs3");
			
			if (wconv.length(wconv.trim(args[10])) > 0) rtnJSON[wconv.trim(args[10])] = DsWs_AddrHistory.getCellData(row, "sAdrsAdd");
			if (wconv.length(wconv.trim(args[11])) > 0) rtnJSON[wconv.trim(args[11])] = DsWs_AddrHistory.getCellData(row, "sAdrsAdd2");
			if (wconv.length(wconv.trim(args[12])) > 0) {
				rtnJSON[wconv.trim(args[12])] = DsWs_AddrHistory.getCellData(row, "sAdrs1")+ " " + DsWs_AddrHistory.getCellData(row, "sAdrs2") +" " +
												DsWs_AddrHistory.getCellData(row, "sAdrs3");
			}
			
			if (wconv.length(wconv.trim(args[13])) > 0) rtnJSON[wconv.trim(args[13])] = DsWs_AddrHistory.getCellData(row, "nChangeNo");
			
			//2014.02.06 새주소
			if (wconv.length(wconv.trim(args[14])) > 0) rtnJSON[wconv.trim(args[14])] = DsWs_AddrHistory.getCellData(row, "sZipType");
			if (wconv.length(wconv.trim(args[15])) > 0) rtnJSON[wconv.trim(args[15])] = DsWs_AddrHistory.getCellData(row, "sAddrMgtNo");
			if (wconv.length(wconv.trim(args[16])) > 0) rtnJSON[wconv.trim(args[16])] = DsWs_AddrHistory.getCellData(row, "nAddrStdSeq");
			if (wconv.length(wconv.trim(args[17])) > 0) rtnJSON[wconv.trim(args[17])] = DsWs_AddrHistory.getCellData(row, "sOrgZipType");
			if (wconv.length(wconv.trim(args[18])) > 0) rtnJSON[wconv.trim(args[18])] = DsWs_AddrHistory.getCellData(row, "sOrgZipCode");
			if (wconv.length(wconv.trim(args[19])) > 0) rtnJSON[wconv.trim(args[19])] = DsWs_AddrHistory.getCellData(row, "sOrgAddr");
		}
console.log("====CBSO025P return args \n"+args);		
console.log("====CBSO025P return close \n"+JSON.stringify(rtnJSON));		
		wprom.close(rtnJSON);			
	};
	]]></script>
    </head>
    <body>
        <xf:group class="cont_wrap layer" id="fCut01012s"
            style="position:absolute; WorkArea:true;  Ver:1.0;  PidAttrib:7;  height:263px; left:0px; top:0px;"
            userData1="주소 히스토리" userData2=" OnLoadCompleted:scwin.fCut01012s_OnLoadCompleted; ">
            <DataObjects>
                <DataObject/>
            </DataObjects>
            <ServiceObjects>
                <ServiceObject/>
            </ServiceObjects>
            <xf:group arcsize="8" class="" id="Shape8"
                style="position:absolute;  bottom:259px; height:231px; left:0px; top:30px; width:648px;" userData3="RoundRect"/>
            <xf:switch id="switch_66" style=" ">
                <xf:case id="Default_67" style=" ">
                    <w2:gridView autoFit="allColumn"
                    	autoFitMinWidth="100" class="sty_Grid"
                    	dataList="DsWs_AddrHistory"
                    	ev:oncelldblclick="scwin.Gri_AddrHistory_oncelldblclick"
                    	focusMode="row" id="Gri_AddrHistory"
                    	inputType="text" readOnly="true"
                    	style="position:absolute; UseDBuff:true;  InputPanel:FALSE;  EndLineColor:default;  border:Flat;  height:218px; left:0px; right:656px; top:32px; width:700px;"
                    	tabIndex="2">
                    	<w2:header>
                    		<w2:row>
                    			<w2:column dataType="text"
                    				id="head_id_469" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				userData1="0" userData3="0" value="회차"
                    				width="40" />
                    			<w2:column colSpan="2" dataType="text"
                    				id="head_id_470" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				textAlign="center" userData1="1" userData3="0"
                    				value="우편번호" width="70" />
                    			<w2:column dataType="text"
                    				id="head_id_471" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				textAlign="center" userData1="3" userData3="0"
                    				value="주소" width="*" />
                    			<w2:column dataType="text"
                    				id="head_id_472" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				textAlign="center" userData1="4" userData3="0"
                    				value="등록일" width="80" />
                    			<w2:column dataType="text"
                    				id="head_id_473" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				userData1="5" userData3="0" value="등록시간"
                    				width="60" />
                    			<w2:column dataType="text"
                    				id="head_id_474" inputType="text"
                    				readOnly="true" style="height:20px;"
                    				userData1="6" userData3="0" value="등록자"
                    				width="60" />
                    		</w2:row>
                    	</w2:header>
                    	<w2:gBody>
                    		<w2:row>
                    			<w2:column dataType="text"
                    				id="nChangeNo" inputType="text" readOnly="true"
                    				style="height:20px;" textAlign="center"
                    				userData1="0" userData3="0" width="40" />
                    			<w2:column dataType="text" id="sZip1"
                    				inputType="text" readOnly="true"
                    				style="height:20px;" textAlign="center"
                    				userData1="1" userData3="0" width="35" />
                    			<w2:column dataType="text" id="sZip2"
                    				inputType="text" readOnly="true"
                    				style="height:20px;" textAlign="center"
                    				userData1="2" userData3="0" width="35" />
                    			<w2:column dataType="text"
                    				id="id_disAddr" inputType="text" readOnly="true"
                    				style="height:20px;" textAlign="left"
                    				userData1="3" userData3="0"
                    				customFormatter="scwin.setDisplayGriAddrHistory" />
                    			<w2:column dataType="date"
                    				displayFormat="yyyy-MM-dd" id="sInputDate"
                    				inputType="text" readOnly="true"
                    				style="height:20px;" textAlign="center"
                    				userData1="4" userData3="0" width="80" />
                    			<w2:column dataType="text"
                    				id="id_inputTime" inputType="text" readOnly="true"
                    				style="height:20px;" userData1="5" userData3="0"
                    				width="65" displayFormat="" customFormatter="scwin.setDisplayGriAddrHistory"/>
                    			<w2:column dataType="text" id="sEmpName"
                    				inputType="text" readOnly="true"
                    				style="height:20px;" userData1="6" userData3="0"
                    				width="60" />
                    		</w2:row>
                    	</w2:gBody>
                    </w2:gridView>
                </xf:case>
            </xf:switch>
            <xf:trigger class="popup_top_btn" ev:onclick="scwin.Btn_Close_onclick" id="Btn_Close"
                style="position:absolute; ImageID:btn_Comm_Close;  height:20px;left:650px;top:0px;" tabIndex="3" type="anchor">
                <xf:label><![CDATA[닫기]]></xf:label>
            </xf:trigger>
            <w2:textbox id="Static5" label="주소 History"
                style="position:absolute; VAlign:Middle;  height:20px; left:0px; top:0px; width:197px;" tagname="" class="sub_pop_title01"/>
        </xf:group>
    </body>
</html>
