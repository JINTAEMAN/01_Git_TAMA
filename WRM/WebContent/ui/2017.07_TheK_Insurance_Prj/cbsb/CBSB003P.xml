<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/cm/css/all.css" type="text/css"?>
<?xml-stylesheet href="/cm/css/new.css" type="text/css"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<w2:type>DEFAULT</w2:type>
		<w2:buildDate />
		<xf:model>
			<xf:instance>
				<data xmlns="" />
			</xf:instance>
			<w2:dataCollection baseNode="map">
				<w2:dataMap baseNode="map" id="param">
					<w2:keyInfo>
						<w2:key id="rgtrEmpno" name="rgtrEmpno"
							dataType="text">
						</w2:key>
						<w2:key id="rgtrName" name="rgtrName"
							dataType="text">
						</w2:key>
						<w2:key id="cstSchdFlgcd" name="cstSchdFlgcd"
							dataType="text">
						</w2:key>
						<w2:key id="name" name="name" dataType="text">
						</w2:key>
						<w2:key id="vistDate" name="vistDate"
							dataType="text">
						</w2:key>
						<w2:key id="vistHms" name="vistHms"
							dataType="text">
						</w2:key>
						<w2:key id="cont" name="cont" dataType="text">
						</w2:key>
						<w2:key id="schdResltFlgcd"
							name="schdResltFlgcd" dataType="text">
						</w2:key>
						<w2:key id="cstVistAdmId" name="cstVistAdmId"
							dataType="text">
						</w2:key>
					</w2:keyInfo>
				</w2:dataMap>
			</w2:dataCollection>
			<w2:workflowCollection>
			</w2:workflowCollection>
			
		</xf:model>
		<script type="javascript"><![CDATA[
	//**********************************************************
	// 초기화
	//**********************************************************
	scwin.init = function() {
	    //Parent에서 넘어온 값을 설정한다.
		var indata = $w.getParameter("param");//
		var args;
		try {
			args = JSON.parse(indata);
		} catch(e) {
		
		}			   
	    
	    //일정 조회	    
	    if(!util.isNull(args) && !util.isNull(args.pCstSchdAdmId)){	   
	    	param.set("cstVistAdmId", args.pCstSchdAdmId );	   
	    	//조회한다.
	   		scwin.getCstVistInfo();
	   		btn_save.setValue("수정");
	   		
	   		
	    	if(!util.isNull(args) 
	    			&& !util.isNull(args.empNo) 
	    			&& !util.isNull(args.empNm)){
	    		logInEmpNo = args.empNo;
	    		logInEmpNm = args.empNm;
	    		edt_empInfo.setValue(logInEmpNm+"["+logInEmpNo+"]");	    	
	    	}
	   		
	    //신규 입력
	    }else{
	    	var logInEmpNo 	= util.getGdsValue("gUserID");
	    	var logInEmpNm 	= util.getGdsValue("gUserEmpName");
	    	var currDate 	= WebSquare.date.getCurrentServerDate("yyyyMMdd");
	    	var currTime 	= WebSquare.date.getCurrentServerDate("hhmm");	    		    		    
	    	
	    	if(!util.isNull(args) 
	    			&& !util.isNull(args.empNo) 
	    			&& !util.isNull(args.empNm)){
	    		logInEmpNo = args.empNo;
	    		logInEmpNm = args.empNm;	    	
	    	}
	    	
	    	chk_visitResult.setValue(0);	    	
	    	edt_empInfo.setValue(logInEmpNm+"["+logInEmpNo+"]");
	    	param.set("rgtrEmpno", logInEmpNo );	    	
	    	edt_visitDate.setValue(currDate);
	    	edt_visitTime.setValue(currTime);
	    	btn_save.setValue("등록");
	    }
	};			
		
	//**********************************************************
	// 일정조회
	//**********************************************************
	scwin.getCstVistInfo = function() {
	
		var trans = new transSub();                  // transaction 보낼 객체 생성
		trans.setId("retrieveCstVistInfo");           // transaction 보낼 SubmissionID
		trans.setUrl("/sales/support/CBSB0010.do");   // Controller 쪽으로 보낼 주소
		trans.setDs("param");					
		trans.targetDs("param");		
		trans.callBack("scwin.subCallBackfunction");  // 받을 Dataset을 처리시 콜백함수
		trans.send();
	
	};
	
	//**********************************************************
	// 일정수정or일정등록
	//**********************************************************	
	scwin.btn_save_onclick = function() {
		
		if(util.isNull(edt_custNm.getValue())){			
        	wprom.alertF("고객명을 입력해 주세요.",{}, edt_custNm);        	
        	return;		
		}
		
		if(util.isNull(sel_visitType.getValue())){			
        	wprom.alertF("구분 값을 선택해 주세요.",{},sel_visitType);
        	return;
		}
		
		if(sel_visitType.getValue()=="00"){			
        	wprom.alertF("구분 값을 선택해 주세요.",{},sel_visitType);        	
        	return;		
		}
		
		if(util.isNull(edt_visitDate.getValue())){			
        	wprom.alertF("방문일정을 입력해 주세요.",{},edt_visitDate);        	
        	return;			
		}
		
		if(util.isNull(edt_visitTime.getValue())){			
        	wprom.alertF("방문시간을 입력해 주세요.",{},edt_visitTime);        	
        	return;		
		}								
		
		//수정저장		
		if(!util.isNull(edt_cstVistAdmId.getValue())){			
			var trans = new transSub();                  // transaction 보낼 객체 생성
			trans.setId("modifyCstVistResltInfo");                // transaction 보낼 SubmissionID
			trans.setUrl("/sales/support/CBSB0012.do");   // Controller 쪽으로 보낼 주소
			trans.setDs("param");					
			trans.targetDs("param");			
			trans.callBack("scwin.subCallBackfunction");  // 받을 Dataset을 처리시 콜백함수
			trans.send();	
			
		
		//신규등록
		}else{		
			var trans = new transSub();                  // transaction 보낼 객체 생성
			trans.setId("registerCstVistInfo");                // transaction 보낼 SubmissionID
			trans.setUrl("/sales/support/CBSB0011.do");   // Controller 쪽으로 보낼 주소
			trans.setDs("param");					
			trans.targetDs("param");			
			trans.callBack("scwin.subCallBackfunction");  // 받을 Dataset을 처리시 콜백함수
			trans.send();
	
		}
		
		
	};

		
	//**********************************************************
	//
	//**********************************************************
	scwin.subCallBackfunction = function(e){
		// e.subID : 서브미션 ID
		// e.flag  : s성공
		// e.msg   : 트렌젝션 처리후 메세지
		// e."받을데이타셋"
		switch(e.subID){
			case "registerCstVistInfo":
				if(e.flag =="s"){
					param.setJSON(e.result);									
					edt_cstVistAdmId.setValue(param.get("cstVistAdmId"));	
					wprom.alert("정상등록되었습니다.");
					// 등록완료후 화면 닫기 
					var returnMsg = "I";
                	if (wprom.isPopup()){
			        	wprom.close(returnMsg);
			        }	
				}else{
					wprom.alert(e.msg);
				}
		
			break;
			case "retrieveCstVistInfo":
				if(e.flag =="s"){
					param.setJSON(e.result);				
					//rgtrName	rgtrEmpno
				}else{
					wprom.alert(e.msg);
				}
			break;						
			case "modifyCstVistResltInfo":
				if(e.flag =="s"){
					wprom.alert("수정이 완료되었습니다.");
					var returnMsg = "I";
                	if (wprom.isPopup()){
			        	wprom.close(returnMsg);
			        }
				}else{
					wprom.alert(e.msg);
				}
			break;
		}
	};
	
	//**********************************************************
	//시간 체크
	//**********************************************************	
	scwin.edt_visitTime_onviewchange = function(info) {
		
		var time = edt_visitTime.getValue();
	
		if(time!= null
			&& time.length >0 
			&& time != ""){
					
			var hour = edt_visitTime.getValue().substring(0, 2);			
			var min = edt_visitTime.getValue().substring(2, 4);
			
			if(hour>=24){
				wprom.alertF("시간확인(시)이 필요 합니다.",{},edt_visitTime);				
				return;
			}
			if(min>=59){
				wprom.alertF("시간확인(분)이 필요 합니다.",{},edt_visitTime);				
				return;
			}
		}else{
			wprom.alertF("시간확인이 필요 합니다.",{},edt_visitTime);					
			return;
		}
	};
	

	
	scwin.btn_close_onclick = function() {
		var returnMsg = "I";
        if (wprom.isPopup()){
       		wprom.close(returnMsg);
       }
	};
	]]></script>
	</head>
	<body>
		<xf:group class="contentWrap layer" id="" style="">

			<!-- group:s -->
			<xf:group id="" style="" class="section">
				<xf:group id="" style="" class="defaultbox">
					<w2:textbox id="" style="" class="df_tt fl"
						label="일정등록">
					</w2:textbox>
					<xf:group class="fr" id="" style="">
						<w2:anchor class="btn_nml"
							ev:onclick="scwin.btn_save_onclick" id="btn_save"
							outerDiv="true">
							<xf:label><![CDATA[등록]]></xf:label>
						</w2:anchor>
						<w2:anchor class="btn_nml"
							ev:onclick="scwin.btn_close_onclick" id="btn_close"
							outerDiv="true" style="">
							<xf:label><![CDATA[닫기]]></xf:label>
						</w2:anchor>
					</xf:group>
				</xf:group>
				<xf:group id="" style="" class="w2tb tb"
					tagname="table">
					<w2:attributes>
						<w2:summary></w2:summary>
					</w2:attributes>
					<xf:group tagname="colgroup">
						<xf:group style="width:105px;"
							tagname="col">
						</xf:group>
						<xf:group style="width:80px;"
							tagname="col">
						</xf:group>
						<xf:group style="width:-21.19%;" tagname="col"></xf:group><xf:group style="width:105.00px;"
							tagname="col">
						</xf:group>
						<xf:group style="width:150.00px;" tagname="col"></xf:group>
						<xf:group style="width:104.00px;" tagname="col">
						</xf:group>
						<xf:group style="" tagname="col"></xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th"
							tagname="th">
							사원정보
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<w2:textbox label="" id="edt_empInfo"
								style="width:233px;height:18px;text-align:left;padding-top:5px;padding-bottom:0px;"
								ref="data:param.rgtrName">
							</w2:textbox>
							<w2:attributes>
								<w2:colspan>2</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
						
							<w2:attributes>
								<w2:scope>row</w2:scope>
							</w2:attributes>
						</xf:group>
						<xf:group class="w2tb_th" tagname="th"
							style="" id="tbl_SchdId">
							일정ID
						</xf:group>
						<xf:group class="w2tb_td" style=""
							tagname="td">
							<w2:textbox id="edt_cstVistAdmId" label=""
								style="width:341px;height:18px;text-align:left;padding-top:5px;padding-bottom:0px;" ref="data:param.cstVistAdmId" ev:onclick="scwin.edt_SchdAdmId_onclick">
							</w2:textbox>
							<w2:attributes>
								<w2:colspan>3</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th"
							tagname="th">
							고객이름
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<xf:input id="edt_custNm"
								style="position: relative;width:100px;height:21px;"
								maxlength="10" ref="data:param.name">
							</xf:input>
							<w2:attributes>
								<w2:colspan>6</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th"
							tagname="th">
							구분
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<xf:select1 allOption=""
								appearance="minimal" chooseOption="" direction="auto"
								disabled="" disabledClass="" displayMode="label"
								ev:onviewchange="" id="sel_visitType" optionOrder="" ref="data:param.cstSchdFlgcd"
								style="" submenuSize="" renderType="native">
								<xf:choices>
									<xf:item>
										<xf:label><![CDATA[-]]></xf:label>
										<xf:value><![CDATA[00]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[증권전달(자)]]></xf:label>
										<xf:value><![CDATA[01]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[초회면담]]></xf:label>
										<xf:value><![CDATA[02]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[상품안내]]></xf:label>
										<xf:value><![CDATA[03]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[가입설계]]></xf:label>
										<xf:value><![CDATA[04]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[계약관리]]></xf:label>
										<xf:value><![CDATA[05]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[증권전달(장)]]></xf:label>
										<xf:value><![CDATA[06]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[소개방문]]></xf:label>
										<xf:value><![CDATA[07]]></xf:value>
									</xf:item>
									<xf:item>
										<xf:label><![CDATA[☎ 전화]]></xf:label>
										<xf:value><![CDATA[08]]></xf:value>
									</xf:item>
								</xf:choices>
							</xf:select1>
						<w2:attributes><w2:scope>row</w2:scope><w2:colspan>2</w2:colspan><w2:rowspan>1</w2:rowspan></w2:attributes></xf:group><xf:group class="w2tb_th" tagname="th">
							방문일정
						</xf:group>
						<xf:group class="w2tb_td" tagname="td">
							<!-- group:s -->
							<!-- group:e -->
							<w2:textbox id="" label="" style=""
								tagname="span">
							</w2:textbox>
							<w2:inputCalendar
								calendarValueType="yearMonthDate" focusOnDateSelect="false"
								footerDiv="false" id="edt_visitDate" renderDiv="true"
								renderType="component" rightAlign="false" style=""
								weekStartsOn="0" calendarImageOver="" ref="data:param.vistDate"
								class="">
							</w2:inputCalendar>
						</xf:group>
						<xf:group style="" class="w2tb_th"
							tagname="th">
							방문시간
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<xf:input id="edt_visitTime"
								style="width:40px;height:21px;" displayFormat="HH:mm"
								dataType="time" displaymessage="" ev:onchange="" maxlength="4"
								ref="data:param.vistHms" ev:onkeyup="" ev:onclick=""
								ev:onmouseout=""
								ev:onviewchange="scwin.edt_visitTime_onviewchange">
							</xf:input>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style=""
							class="w2tb_th" tagname="th">
							메모
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<w2:attributes>
								<w2:colspan>6</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
							<xf:textarea id="edt_memo"
								style="height:100px;width:534px;" ref="data:param.cont" maxByteLength="" maxlength="220"/>
						</xf:group>
					</xf:group>
					<xf:group style="" tagname="tr">
						<xf:group style="" class="w2tb_th"
							tagname="th">
							방문결과
						</xf:group>
						<xf:group style="" class="w2tb_td"
							tagname="td">
							<w2:attributes>
								<w2:colspan>6</w2:colspan>
								<w2:rowspan>1</w2:rowspan>
							</w2:attributes>
							<xf:select appearance="full"
								id="chk_visitResult" selectedindex="-1" style="" cols="" rows=""
								ref="data:param.schdResltFlgcd">
								<xf:choices>
									<xf:item>
										<xf:label><![CDATA[완료]]></xf:label>
										<xf:value><![CDATA[1]]></xf:value>
									</xf:item>
								</xf:choices>
							</xf:select>

						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
			<!-- group:e -->

			<!-- group:s -->
			<!-- group:e -->

		</xf:group>
	</body>
</html>